import{_ as e,P as t,Q as i,S as o,a4 as n,a5 as c,a6 as p,a3 as s,C as l}from"./framework-7e8eb00a.js";const r="/java-doc/img/sql/mongodb/2-3-1.png",d={},u=s(`<h2 id="连接副本集" tabindex="-1"><a class="header-anchor" href="#连接副本集" aria-hidden="true">#</a> 连接副本集</h2><h4 id="_1-修复host" tabindex="-1"><a class="header-anchor" href="#_1-修复host" aria-hidden="true">#</a> 1. 修复host</h4><p>当时初始化副本集的时候，节点成员的host都是区域网ip，这是无法正常连接的。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">conf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//查看member可知，节点的host都是区域网ip</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在使用Compass连接副本集时，会连接这些ip，本地ip肯定是不行的，会连接失败，因此需要修复这些host。</p><h5 id="_1-1-修改副本集节点的host" tabindex="-1"><a class="header-anchor" href="#_1-1-修改副本集节点的host" aria-hidden="true">#</a> 1.1 修改副本集节点的host</h5><p>实际上就是改一下 config，修改的代码如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>config <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">conf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
config<span class="token punctuation">.</span>members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>host<span class="token operator">=</span><span class="token string">&quot;159.75.225.162:27017&quot;</span> <span class="token comment">//主节点</span>
config<span class="token punctuation">.</span>members<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>host<span class="token operator">=</span><span class="token string">&quot;159.75.225.162:27018&quot;</span> <span class="token comment">//从节点</span>
config<span class="token punctuation">.</span>members<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>host<span class="token operator">=</span><span class="token string">&quot;159.75.225.162:27019&quot;</span> <span class="token comment">//从节点</span>
rs<span class="token punctuation">.</span><span class="token function">reconfig</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;force&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-连接副本集" tabindex="-1"><a class="header-anchor" href="#_2-连接副本集" aria-hidden="true">#</a> 2. 连接副本集</h4>`,9),m=s(`<h2 id="数据读写" tabindex="-1"><a class="header-anchor" href="#数据读写" aria-hidden="true">#</a> 数据读写</h2><h5 id="_1-主节点读写" tabindex="-1"><a class="header-anchor" href="#_1-主节点读写" aria-hidden="true">#</a> 1. 主节点读写</h5><p>登录主节点进行读写操作。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>myrs<span class="token punctuation">[</span>direct:primary<span class="token punctuation">]</span>article<span class="token operator">&gt;</span> use article  <span class="token comment"># 创建或选择article库</span>
<span class="token comment"># &#39;switched to db article&#39;</span>
db
articel <span class="token comment"># 显示当前数据库</span>
db.comment.insertOne<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment"># 插入一条数据</span>
    <span class="token string">&quot;articleid&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10000&quot;</span>,
    <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;that&#39;s good&quot;</span>,
    <span class="token string">&quot;userid&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;1000&quot;</span>,
    <span class="token string">&quot;createdatetime&quot;</span><span class="token builtin class-name">:</span> new Date<span class="token punctuation">(</span><span class="token punctuation">)</span>,
    <span class="token string">&quot;likenum&quot;</span>:NumberInt<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>,
    <span class="token string">&quot;state&quot;</span>:null
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">{</span> <span class="token comment"># 插入成功</span>
  acknowledged: true,
  insertedId: ObjectId<span class="token punctuation">(</span><span class="token string">&quot;64487fe22c64c9d9921960f8&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>插入数据成功后，在Compass中，确实可以看到数据库创建成功，数据也插入成功。</p><h4 id="_2-从节点读写" tabindex="-1"><a class="header-anchor" href="#_2-从节点读写" aria-hidden="true">#</a> 2. 从节点读写</h4><p>登录副本从节点进行读写</p><div class="hint-container danger"><p class="hint-container-title">警告</p><p>登录时依然要勾选：Direct Connection</p></div><p>在Compass登录成功后是无法查看Databases的，页面是空白的。</p><figure><img src="`+r+`" alt="2-3-1" tabindex="0" loading="lazy"><figcaption>2-3-1</figcaption></figure><p>在shell中可以查看数据库，和集合信息，但是无法读取集合内的数据。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show dbs  <span class="token comment"># 可以正常查看数据库列表</span>
use article <span class="token comment"># 可以正常选择数据库</span>
myrs <span class="token punctuation">[</span>direct: secondary<span class="token punctuation">]</span> article <span class="token operator">&gt;</span>show collections <span class="token comment"># 可以查看集合</span>
<span class="token comment"># comment ，该库中有个comment集合</span>
myrs <span class="token punctuation">[</span>direct: secondary<span class="token punctuation">]</span> article <span class="token operator">&gt;</span>db.comment.find<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 读取集合中的数据</span>
<span class="token comment"># 以下是报错信息</span>
MongoServerError: not primary and <span class="token assign-left variable">secondaryOk</span><span class="token operator">=</span>false -
consider using db.getMongo<span class="token punctuation">(</span><span class="token punctuation">)</span>.setReadPref<span class="token punctuation">(</span><span class="token punctuation">)</span> or readPreference 
<span class="token keyword">in</span> the connection string

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当前从节点只是一个备份，不是奴隶节点，无法读取数据，写当然更不行。<br> 因为默认情况下，从节点是没有读写权限的，可以增加读的权限，但需要进行设置。</p><h5 id="_1-3-设置读操作权限" tabindex="-1"><a class="header-anchor" href="#_1-3-设置读操作权限" aria-hidden="true">#</a> 1.3 设置读操作权限：</h5><p>将从节点设置为奴隶节点，允许在从成员上运行读的操作。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>r
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-主节点的选举" tabindex="-1"><a class="header-anchor" href="#_2-主节点的选举" aria-hidden="true">#</a> 2. 主节点的选举</h4><h4 id="_3-故障测试" tabindex="-1"><a class="header-anchor" href="#_3-故障测试" aria-hidden="true">#</a> 3. 故障测试</h4><h4 id="_4-compass连接副本集" tabindex="-1"><a class="header-anchor" href="#_4-compass连接副本集" aria-hidden="true">#</a> 4. Compass连接副本集</h4><h4 id="_5-java连接副本集" tabindex="-1"><a class="header-anchor" href="#_5-java连接副本集" aria-hidden="true">#</a> 5. Java连接副本集</h4>`,20);function h(k,v){const a=l("RouterLink");return t(),i("div",null,[u,o("p",null,[n("详见："),c(a,{to:"/sql/mongodb/4.dev/4-1.Compass.html"},{default:p(()=>[n("Compass")]),_:1})]),m])}const g=e(d,[["render",h],["__file","2-3.操作副本集.html.vue"]]);export{g as default};
