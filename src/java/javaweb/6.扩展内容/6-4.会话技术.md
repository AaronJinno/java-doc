---
title: 6-4. 会话技术
date: 2023-06-10
---
:::danger 提醒
当前开发，以移动平台为主，因此优先采用的是Token技术。

Cookie和Session只有浏览器能用
:::

## 会话技术介绍
#### 1. 会话
用户打开浏览器，访问web服务器的资源，会话建立，直到有一方断开连接，会话结束。

在一次会话中可以包含多次请求和响应。
- 从浏览器发出请求到服务端响应数据给前端之后，一次会话(在浏览器和服务器之间)就被建立了
- 会话被建立后，如果浏览器或服务端都没有被关闭，则会话就会持续建立着
- 浏览器和服务器就可以继续使用该会话进行请求发送和响应，上述的整个过程就被称之为会话。

#### 2. 不同的会话
每个浏览器与服务器建立的会话都是不同的会话，如图，一共有三个会话。

![6-4-1](/img/java/javaweb/6-4-1.jpg)

#### 3. 会话跟踪
一种维护浏览器状态的方法，服务器需要识别多次请求是否来自于同一浏览器，以便在同一次会话的多次请求间共享数据。
- 服务器会收到多个请求，这多个请求可能来自多个浏览器，如上图中的6个请求来自3个浏览器
- 服务器需要用来识别请求是否来自同一个浏览器
- 服务器用来识别浏览器的过程，这个过程就是会话跟踪
- 服务器识别浏览器后就可以在同一个会话中多次请求之间来共享数据

#### 4. 无状态协议
浏览器和服务器之间使用的是HTTP请求来进行数据传输，HTTP协议是无状态的，每次浏览器向服务器请求时，服务器都会将该请求视为新的请求。HTTP协议设计成无状态的目的是让每次请求之间相互独立，互不影响，请求与请求之间独立后，就无法实现多次请求之间的数据共享。

#### 5. 会话追踪技术
- cookie：客户端会话跟踪技术
- session：服务端会话跟踪技术
这两个技术都可以实现会话跟踪，它们之间最大的区别:Cookie是存储在浏览器端而Session是存储在服务器端


## Cookie
客户端会话技术，将数据保存到客户端，以后每次请求都携带Cookie数据进行访问。

#### 1. 使用步骤
- Servlet-1：创建Cookie对象，绑定数据
- Servlet-1：发送Cookie对象->给浏览器
- 浏览器：保存Cookie，并在下一次请求时携带Cookie
- Servlet-2：拿到浏览器发送请求时携带的Cookie数据

#### 2. Cookie的相关方法
##### 2.1 创建Cookie对象
同时构造方法会设置cookie的key 和value
```java
new Cookie(String name, String value)

Cookie cookie = new Cookie("key","value");
```
##### 2.2 发送Cookie对象
将cookie对象通过响应对象Response，发送到客户端。
```java
void ServletResponse.addCookie(Cookie c);
response.addCookie(cookie);
```
##### 2.3 获取Cookie数据
可以通过请求对象Request获取cookie，Cookie可能有多个，因此返回的是数组
```java
Cookie[] ServletRequest.getCookies();

Cookie[] cookies = request.getCookies();
```
##### 2.4 获取Cookie的name和value
遍历获取的Cookie数据（数组）,来获取具体的key，value
```java
String Cookie.getName(); //获取Cookie的name
String Cookie.getValue();//获取Cookie的Value
//循环Cookie[]获取Cookie
for (Cookie c : cs) {
    String name = c.getName();
    String value = c.getValue();
}
```

#### 3. Cookie使用范例
##### 3.1 servlet1：创建cookie
```java
protected void doPost(HttpServletRequest req, HttpServletResponse resp){
    //1.创建Cookie对象
    Cookie c = new Cookie("msg","hello");
    //2.发送Cookie
    response.addCookie(c);  
}
```
##### 3.2 servlet2：获取cookie
```java
protected void doPost(HttpServletRequest req, HttpServletResponse resp){
   //3. 获取Cookie
    Cookie[] cs = req.getCookies();
    //4.获取数据，遍历Cookies
    if(cs != null){
        for (Cookie c : cs) {
            String name = c.getName();
            if("msg".equals(name)){
               String value = c.getValue();
               System.out.println(name+":"+value);    
               break;             
            }
        }
    }
}
```

#### 4. Cookie的工作原理
提示：Cookie有关的所有操作都是基于请求头和响应头的，只是Servlet直接封装了一套api，省去了直接操作消息头。

##### 4.1 Servlet1创建并发送Cookie
创建new Cookie(String name, String value)的本质是创建了一个响应头
```java
set-cookie:msg=hello
```
然后通过response响应给了浏览器，响应头里就有了set-cookie

## Session

## 总结

