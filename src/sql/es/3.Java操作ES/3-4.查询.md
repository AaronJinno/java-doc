---
title: 3-4. 文档查询
date: 2023-06-27
---
## 基本查询
最基本的查询是：通过主键 `_id` 查询，或者直接查询索引下所有的文档
#### 1. 根据_id 查询文档
需要GetRequest请求对象，代码如下：
```java
public class ESTest3 {
    @SneakyThrows
    public static void main(String[] args) {
        //创建ES 客户端
        RestClientBuilder builder = RestClient.builder(
                new HttpHost("localhost", 9200, "http")
        );
        RestHighLevelClient esClient = new RestHighLevelClient(builder);


        //根据_id查询文档：这里指的是局部修改
        //创建请求对象：GetRequest
        GetRequest request = new GetRequest();

        //关联要修改的索引和文档_id
        request.index("user").id("1001");

        //发送请求，获取响应结果
        GetResponse response = esClient.get(request, RequestOptions.DEFAULT);

        //以JSON字符串的格式打印查询结果
        System.out.println(response.getSourceAsString());

        //关闭 ES 客户端
        esClient.close();
    }
}
```
打印结果：`{"name":"Victor","gender":"female","age":20}`

#### 2. 查询所有文档
通过SearchRequest对象，可以查看指定索引下的所有文档，代码如下：
```java
public class ESTest3 {
    @SneakyThrows
    public static void main(String[] args) {
        //创建ES 客户端
        RestClientBuilder builder = RestClient.builder(
                new HttpHost("localhost", 9200, "http")
        );
        RestHighLevelClient esClient = new RestHighLevelClient(builder);

        //查询所有文档
        //创建请求对象：SearchRequest
        SearchRequest request = new SearchRequest();

        //关联要查看的索引
        request.indices("user");

        // 构建查询的请求体
        SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();

        //查询所有数据
        sourceBuilder.query(QueryBuilders.matchAllQuery());
        request.source(sourceBuilder);

        //发送请求
        SearchResponse response = esClient.search(request, RequestOptions.DEFAULT);

        //查看查询的结果
        SearchHits hits = response.getHits();
        for (SearchHit hit : hits) {
            System.out.println(hit.getSourceAsString());
        }

        //关闭 ES 客户端
        esClient.close();
    }
}
```
打印结果如下：
```json
{"name":"Victor","gender":"female","age":20}
{"name":"V","age":"20","gender":"male"}
{"name":"Jinno","age":"21","gender":"male"}
{"name":"Tom","age":"22","gender":"male"}
```

## 条件查询
通过SearchRequest请求对象进行查询，通过SearchSourceBuilder对象构建查询的请求体，在请求体中设置查询条件。

示例代码：
```java
public class ESTest4 {
    @SneakyThrows
    public static void main(String[] args) {
        //创建ES 客户端
        RestClientBuilder builder = RestClient.builder(
                new HttpHost("localhost", 9200, "http")
        );
        RestHighLevelClient esClient = new RestHighLevelClient(builder);

        //条件查询
        //创建请求对象：SearchRequest
        SearchRequest request = new SearchRequest();

        //指定要查询的索引
        request.indices("user");

        //构建查询条件：也就是请求体
        request.source(
            new SearchSourceBuilder().query(
                QueryBuilders.matchQuery("age", "20")
            )
        );

        //发送请求，查询数据
        SearchResponse response = esClient.search(request, RequestOptions.DEFAULT);

        //查看查询的结果集
        SearchHits hits = response.getHits();
        for(SearchHit hit : hits){
            System.out.println(hit);
        }

        //关闭 ES 客户端
        esClient.close();
    }
}

```
打印的结果
```json
{
  "_index" : "user",
  "_id" : "1001",
  "_score" : 1.0,
  "_source" : {
    "name" : "Victor",
    "gender" : "female",
    "age" : 20
  }
}
{
  "_index" : "user",
  "_id" : "1002",
  "_score" : 1.0,
  "_source" : {
    "name" : "V",
    "age" : "20",
    "gender" : "male"
  }
}
```

#### 全量查询
请求体内的查询条件可以设置为：matchAllQuery()，这样就可以查询索引内所有的文档了。
```java
//构建查询条件：也就是请求体
request.source(
    new SearchSourceBuilder().query(QueryBuilders.matchAllQuery())
);
```

## 多条件查询


## 查询指定字段

## 范围查询

## 模糊查询

## 分页

## 排序

## 高亮