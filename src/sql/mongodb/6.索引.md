---
title: 6. 索引
date: 2023-04-11
---
索引支持在MongoDB中高效地执行查询。  

- 如果没有索引，MongoDB必须执行全集合扫描，以选择与查询语句匹配的文档。这种扫描全集合的查询效率是非常低的。
- 索引项的排序支持有效的相等匹配和基于范围的查询操作。此外，MongoDB还可以使用索引中的排序返回排序结果。  
- MongoDB索引使用B树数据结构（确切的说是B-Tree，MySQL是B+Tree）


## 索引的类型
#### 1. 单字段索引
在文档的单个字段上创建用户定义的升序/降序索引，称为单字段索引（Single Field Index）。  

对于单个字段索引和排序操作，索引键的排序顺序（即升序或降序）并不重要，因为MongoDB可以在任何方向上遍历索引。

#### 2. 复合索引
MongoDB还支持多个字段的用户定义索引，即复合索引（Compound Index）。  

复合索引中列出的字段顺序很重要。例如，如果复合索引由 { userid: 1, score: -1 } 组成，则索引首先按userid正序排序，然后在每个userid的值内，再在按score倒序排序。


#### 3. 其他索引
- 地理空间索引（Geospatial Index）：为了支持对地理空间坐标数据的有效查询，MongoDB提供了两种特殊的索引：返回结果时使用平面几何的二维索引和返回结果时使用球面几何的二维球面索引。
- 文本索引（Text Indexes）：支持在集合中搜索字符串内容。这些文本索引不存储特定于语言的停止词（例如“the”、“a”、“or”），而将集合中的词作为词干，只存储根词。
- 哈希索引（Hashed Indexes）：MongoDB提供了散列索引类型，它对字段值的散列进行索引。这些索引在其范围内的值分布更加随机，但只支持相等匹配，不支持基于范围的查询。

## 管理索引

#### 1. 查看索引
getIndexes()方法返回一个集合中的所有索引的数组。
```js
db.集合.getIndexes()
```

**示例**
```js
//查看comment集合中所有的索引情况
db.comment.getIndexes()

//结果
[ 
    { 
        v: 2,   //索引引擎版本，不用管，内置的
        key: { 
            _id: 1  //索引的字段，和排序方式
        }, 
        name: '_id_'  //索引名，默认是索引字段+ _
    } 
]
```

**_id索引**  

MongoDB在创建集合的过程中，在_id 字段上创建一个唯一的索引，默认名字为_id_。
  
注意：该索引是唯一索引，因此值不能重复，即 _id 值不能重复的。在分片集群中，通常使用 _id 作为片键。

#### 2. 创建索引
在集合上通过createIndex方法创建索引。
```js
db.集合.createIndex(keys,options)
```

##### 2.1 参数
- keys：该参数是一个对象，用来设置索引的字段和索引的排序方式。
    - {字段: 排序方式}。
    - 排序方式取值1或-1,1表示正序创建索引，-1表示降序创建索引。
- options：可选，包含一组控制索引创建的选项的文档，一般不用设置。
    - unique：建立的索引是否唯一，指定为true创建唯一索引。默认值为false.
    - name：索引的名称，不指定的话就会根据字段名自动生成一个。


#### 2.2 创建单字段索引

#### 2.3 创建复合索引


#### 3. 移除索引


#### 4. 执行计划


#### 5. 涵盖查询
