<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.63" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://aicell.cc/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-4.Linux%E9%9B%86%E7%BE%A4.html"><meta property="og:site_name" content="Java全栈"><meta property="og:title" content="4-4. Linux集群"><meta property="og:description" content="致命注意事项： 搭建集群默认是在一个局域网的，无论是官网提示的操作步骤还是网络上别人分享的教程，都是在同一个区域网下的集群。; 跨网络的集群搭建按照各种教程都会失败，因为节点互相访问时采用的是内网ip。; ES会发现同一区域网下的其他节点，很多教程都是基于这个自动发现搭建的。; 跨网络集群属于高级内容; Linux上的Elasticsearch集群和单..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-07-03T19:00:22.000Z"><meta property="article:author" content="Victor Da V"><meta property="article:published_time" content="2023-06-28T00:00:00.000Z"><meta property="article:modified_time" content="2023-07-03T19:00:22.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"4-4. Linux集群","image":[""],"datePublished":"2023-06-28T00:00:00.000Z","dateModified":"2023-07-03T19:00:22.000Z","author":[{"@type":"Person","name":"Victor Da V","url":"https://aicell.cc/about"}]}</script><link rel="icon" href="/java-doc/favicon.svg"><link rel="manifest" href="/java-doc/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>4-4. Linux集群 | Java全栈</title><meta name="description" content="致命注意事项： 搭建集群默认是在一个局域网的，无论是官网提示的操作步骤还是网络上别人分享的教程，都是在同一个区域网下的集群。; 跨网络的集群搭建按照各种教程都会失败，因为节点互相访问时采用的是内网ip。; ES会发现同一区域网下的其他节点，很多教程都是基于这个自动发现搭建的。; 跨网络集群属于高级内容; Linux上的Elasticsearch集群和单...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/java-doc/assets/style-3040979c.css" as="style"><link rel="stylesheet" href="/java-doc/assets/style-3040979c.css">
    <link rel="modulepreload" href="/java-doc/assets/app-23bfaf90.js"><link rel="modulepreload" href="/java-doc/assets/4-4.Linux集群.html-eac6559a.js"><link rel="modulepreload" href="/java-doc/assets/4-3-5-b81a3122.js"><link rel="modulepreload" href="/java-doc/assets/4-4.Linux集群.html-d130edb1.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/java-doc/"><img class="vp-nav-logo" src="/java-doc/logo.svg" alt="Java全栈"><!----><span class="vp-site-name hide-in-pad">Java全栈</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/java-doc/guide/"><span class="font-icon icon iconfont icon-zhinan" style=""></span>指南<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Java"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/javase/"><span class="font-icon icon iconfont icon-java" style=""></span>JavaSE<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/javaweb/"><span class="font-icon icon iconfont icon-java1" style=""></span>JavaWeb<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/jvm/"><span class="font-icon icon iconfont icon-JVM" style=""></span>JVM<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/func/"><span class="font-icon icon iconfont icon-java3" style=""></span>内置资源<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/idea/"><span class="font-icon icon iconfont icon-Idea" style=""></span>IDEA<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="框架"><span class="title"><span class="font-icon icon iconfont icon-SPRINGMVC" style=""></span>框架</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>依赖管理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/maven/"><span class="font-icon icon iconfont icon-maven" style=""></span>Maven<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>SSM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/spring/"><span class="font-icon icon iconfont icon-SPRINGMVC" style=""></span>Sping<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/springmvc/"><span class="font-icon icon iconfont icon-spring" style=""></span>SpringMVC<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/mybatis/"><span class="font-icon icon iconfont icon-MYBATIS" style=""></span>MyBatis<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/mybatisplus/"><span class="font-icon icon iconfont icon-mybatis-plus" style=""></span>MyBatisPlus<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>开发框架</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/springboot/"><span class="font-icon icon iconfont icon-SPRINGBOOT" style=""></span>SpringBoot<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="微服务"><span class="title"><span class="font-icon icon iconfont icon-weifuwu" style=""></span>微服务</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/sc/"><span class="font-icon icon iconfont icon-spring-cloud" style=""></span>SpringCloud &amp; Alibaba<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/nacos/"><span class="font-icon icon iconfont icon-Nacos" style=""></span>Nacos<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/gateway/"><span class="font-icon icon iconfont icon-gateway" style=""></span>Gateway<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/openfeign/"><span class="font-icon icon iconfont icon-http" style=""></span>OpenFeign<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/Seata/"><span class="font-icon icon iconfont icon-seat-a-select" style=""></span>Seata<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/sentinel/"><span class="font-icon icon iconfont icon-sentinel" style=""></span>Sentinel<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/old/"><span class="font-icon icon iconfont icon-jinggao" style=""></span>过时组件<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="SQL"><span class="title"><span class="font-icon icon iconfont icon-sql" style=""></span>SQL</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/mysql/"><span class="font-icon icon iconfont icon-xingzhuang" style=""></span>MySQL<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/redis/"><span class="font-icon icon iconfont icon-redis" style=""></span>Redis<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/mongodb/"><span class="font-icon icon iconfont icon-connection-MongoDB" style=""></span>MongoDB<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/memcache/"><span class="font-icon icon iconfont icon-memcacheyunshujukuMemcac" style=""></span>Memcache<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link active" href="/java-doc/sql/es/"><span class="font-icon icon iconfont icon-elasticsearch-Elasticsearch" style=""></span>ES<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="服务器"><span class="title"><span class="font-icon icon iconfont icon-database" style=""></span>服务器</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/linux/"><span class="font-icon icon iconfont icon-linux__easyiconnet" style=""></span>Linux<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/shell/"><span class="font-icon icon iconfont icon-powershell" style=""></span>shell<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/nginx/"><span class="font-icon icon iconfont icon-nginx" style=""></span>Nginx<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/docker/"><span class="font-icon icon iconfont icon-Docker" style=""></span>Docker<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="轮子"><span class="title"><span class="font-icon icon iconfont icon-zujiancaozuozujianfuxuankuangxuanzhong" style=""></span>轮子</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/blocks/rouyi/"><span class="font-icon icon iconfont icon-guihuaheshi" style=""></span>若依rouyi<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="dev"><span class="title"><span class="font-icon icon iconfont icon-kaifa1" style=""></span>dev</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/dev/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"><span class="font-icon icon iconfont icon-xinshouzhinan" style=""></span>项目开发指南<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="项目"><span class="title"><span class="font-icon icon iconfont icon-shixushujuku" style=""></span>项目</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/item/learn/"><span class="font-icon icon iconfont icon-xinshouzhinan" style=""></span>学习项目<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="其他"><span class="title"><span class="font-icon icon iconfont icon-qita" style=""></span>其他</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>工具</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other/git/"><span class="font-icon icon iconfont icon-git" style=""></span>Git<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>理论</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other/mode.html"><span class="font-icon icon iconfont icon-shejimoshi" style=""></span>设计模式<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>专业与通用技术</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other/regex.html"><span class="font-icon icon iconfont icon-zhengzebiaodashi" style=""></span>正则<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>插件</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other//plugin/swagger/"><span class="font-icon icon iconfont icon-swagger" style=""></span>swagger<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-xingzhuang" style=""></span><span class="vp-sidebar-title">         MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-redis" style=""></span><span class="vp-sidebar-title">        Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-memcacheyunshujukuMemcac" style=""></span><span class="vp-sidebar-title">    Memcache</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-connection-MongoDB" style=""></span><span class="vp-sidebar-title">    MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-elasticsearch-Elasticsearch" style=""></span><span class="vp-sidebar-title">ElasticSearch</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/map.html"><!---->     -&gt;Map<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">1.ES入门</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">2.HTTP操作</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">3.Java操作ES</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">4.环境部署</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-1.%E5%8D%95%E6%9C%BA%E4%B8%8E%E9%9B%86%E7%BE%A4.html"><!---->4-1. 单机与集群<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-2.windows%E9%9B%86%E7%BE%A4.html"><!---->4-2. windows集群<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html"><!---->4-3. Linux 单机<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-4.Linux%E9%9B%86%E7%BE%A4.html"><!---->4-4. Linux集群<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-4.Linux%E9%9B%86%E7%BE%A4.html#安装es"><!---->安装ES<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-4.Linux%E9%9B%86%E7%BE%A4.html#启动主节点"><!---->启动主节点<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-4.Linux%E9%9B%86%E7%BE%A4.html#创建集群"><!---->创建集群<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-4.Linux%E9%9B%86%E7%BE%A4.html#配置文件"><!---->配置文件<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-4.Linux%E9%9B%86%E7%BE%A4.html#debug-1"><!---->debug<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-5.Kibana.html"><!---->4-5. Kibana<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-6.%E9%87%8D%E8%A6%81%E9%85%8D%E7%BD%AE.html"><!---->4-6. 重要配置<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">5.底层原理</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">7.优化</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">x.dev</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->4-4. Linux集群</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://aicell.cc/about" target="_blank" rel="noopener noreferrer">Victor Da V</a></span><span property="author" content="Victor Da V"></span></span><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-06-28T00:00:00.000Z"></span><!----><!----><span class="page-word-info" aria-label="字数🔠" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 3444 字</span><meta property="wordCount" content="3444"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#安装es">安装ES</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#启动主节点">启动主节点</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#创建集群">创建集群</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#配置文件">配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#debug-1">debug</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><div class="hint-container danger"><p class="hint-container-title">警告</p><p>致命注意事项：</p><ul><li>搭建集群默认是在一个局域网的，无论是官网提示的操作步骤还是网络上别人分享的教程，都是在同一个区域网下的集群。</li><li>跨网络的集群搭建按照各种教程都会失败，因为节点互相访问时采用的是内网ip。</li><li>ES会发现同一区域网下的其他节点，很多教程都是基于这个自动发现搭建的。</li><li>跨网络集群属于高级内容</li></ul></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>Linux上的Elasticsearch集群和单机有很多重复的步骤，这里进行了重复的列出，方便查询。</p><p>小技巧：所有节点可以先跑通单节点，验证了主机的可靠性后再配置集群，以免遇到了主机问题，而误以为是集群配置问题。</p></div><div class="hint-container info"><p class="hint-container-title">集群环境</p><p>三台服务器组成集成环境，服务器都是在线的服务器，如下：</p><ul><li>tx-1：【159.75.225.162】 <strong>node1</strong>，<code>master</code>，个人腾讯云 <ul><li><code>CentOS Stream 9</code>：4核8G</li></ul></li><li>ali-2：【120.79.149.95】 <strong>node2</strong>，公司阿里云 <ul><li><code>CentOS Stream 9</code>：2核4G</li></ul></li><li>aws-3：【52.194.241.105】 <strong>node3</strong>，日本节点亚马逊云 <ul><li><code>Red Hat 9 Enterprise</code>：1核1G</li></ul></li></ul></div><h4 id="整体步骤" tabindex="-1"><a class="header-anchor" href="#整体步骤" aria-hidden="true">#</a> 整体步骤</h4><ul><li>安装：3个服务器都要进行 <ul><li>下载Elasticsearch 8.7.0</li><li>上传到服务器：/opt/soft-bar/</li><li>解压到：/opt/es/（此时ES软件目录为：<code>/opt/es/es-8.7.0/</code>）</li><li>补齐目录：<code>es-8.7.0/data</code>和<code>es-8.7.0/certs</code></li><li>创建es用户：创建一个专门的用户es，用来启动es服务</li></ul></li><li>启动主节点 <ul><li>先启动一个节点：主节点tx-1 <ul><li>形成集群：主节点启动后，自动创建一个集群，其他节点只需要加入该集群</li><li>创建证书：主节点启动后，会创建三张证书，用于TLS和节点间的通信</li><li>启动安全配置，返回安全配置信息</li></ul></li><li>修改配置：修改主节点的配置，使其允许其他集群加入主节点创建的集群</li><li>重启主节点：修改完配置后，删除data信息，重启节点</li></ul></li><li>创建集群 <ul><li>生成token：在主节点上生成token</li><li>启动新节点：启动时，使新节点使用新生成的token。</li><li>加入集群：新节点使用token时会自动生成和主节点相同的证书，从而加入集群。</li><li>多个新节点：只需要重复进行前面三个步骤即可。</li></ul></li></ul><h2 id="安装es" tabindex="-1"><a class="header-anchor" href="#安装es" aria-hidden="true">#</a> 安装ES</h2><p>ES8需要Java17，不过ES8会默认会捆绑JDK，所以不配置Java环境也可以。</p><p>三台服务区都要同步进行以下步骤进行初始的安装</p><h4 id="_1-下载es" tabindex="-1"><a class="header-anchor" href="#_1-下载es" aria-hidden="true">#</a> 1. 下载ES</h4><ul><li>下载地址：<a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch" target="_blank" rel="noopener noreferrer">LINUX_X86_64<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>可以在本地下载上传到服务器，也可以直接在服务器进行wget下载。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.7.0-linux-x86_64.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-上传安装包-规划目录" tabindex="-1"><a class="header-anchor" href="#_2-上传安装包-规划目录" aria-hidden="true">#</a> 2. 上传安装包，规划目录</h4><ul><li>上传目录：<code>/opt/soft-bar/</code>，该目录用来存放安装包</li><li>工作目录：<code>/opt/es/</code>：该目录存放所有ES相关的内容 <ul><li>解压目录：<code>/opt/es/es-8.7.0/</code></li><li>其他ES文件也都放在该目录下，包括Kibana</li></ul></li></ul><h5 id="_3-解压缩" tabindex="-1"><a class="header-anchor" href="#_3-解压缩" aria-hidden="true">#</a> 3. 解压缩</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /opt/soft-bar
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> elasticsearch-8.7.0-linux-x86_64.tar.gz <span class="token parameter variable">-C</span> /opt/es
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>解压后的目录结构：</p><figure><img src="/java-doc/img/sql/es/4-3-1.jpg" alt="4-3-1" tabindex="0" loading="lazy"><figcaption>4-3-1</figcaption></figure><ul><li>bin：可执行脚本目录</li><li>config：配置目录</li><li>jdk：内置JDK</li><li>lib：内置类库</li><li>logs：日志目录</li><li>modules：模块目录</li><li>plugins：插件目录</li></ul><h5 id="_4-补齐目录" tabindex="-1"><a class="header-anchor" href="#_4-补齐目录" aria-hidden="true">#</a> 4. 补齐目录</h5><p>解压后的目录结构还缺一个数据文件目录 <code>/data/</code> 和证书目录 <code>/config/certs</code>。</p><p>这俩目录会在首次启动ES时，自动创建。</p><h4 id="_5-创建es用户" tabindex="-1"><a class="header-anchor" href="#_5-创建es用户" aria-hidden="true">#</a> 5. 创建es用户</h4><p>Elasticsearch 不能使用 root用户启动，因此要创建一个名为es的用户操作Elasticsearch。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">useradd</span> es <span class="token comment"># 创建用户</span>
<span class="token function">passwd</span> es <span class="token comment"># 设置密码，回车输入密码，这里暂密码暂定为es</span>
<span class="token function">chown</span> <span class="token parameter variable">-R</span> es:es /opt/es/elasticsearch-8.7.0 <span class="token comment"># 修改文件拥有者</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="启动主节点" tabindex="-1"><a class="header-anchor" href="#启动主节点" aria-hidden="true">#</a> 启动主节点</h2><p>三台主机都配置好后，首先启动主节点tx-1，其他的主机不要启动。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 启动服务</span>
<span class="token builtin class-name">cd</span> /opt/es/elasticsearch-8.7.0/
bin/e
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>不做任何集群相关的配置，只启动一个节点，其实也是开启了集群，只是该集群只有一个节点，且默认不允许其他节点加入</p></div><h4 id="_1-直接启动主节点" tabindex="-1"><a class="header-anchor" href="#_1-直接启动主节点" aria-hidden="true">#</a> 1. 直接启动主节点</h4><p>不用修改任何配置，采用默认的即可，直接启动主节点(tx-1)。</p><p>启动主节点后，会自动开启安全配置功能，包括：</p><ul><li>创建证书：为传输层和HTTP层启用TLS，并自动生成用于配置TLS的密钥和证书</li><li>自动修改配置文件：自动在配置文件中加入安全配置信息</li><li>返回授权信息：启用身份认证和授权，并将授权信息返回 <ul><li>内置超级用户​​elastic​​,并生成默认密码</li><li>生成注册token等</li></ul></li></ul><h4 id="_2-创建证书" tabindex="-1"><a class="header-anchor" href="#_2-创建证书" aria-hidden="true">#</a> 2. 创建证书</h4><p>第一次启动节点时，会自动创建证书。证书是用来进行身份验证，防止请求被篡改的。仅在主节点（tx-1）上使用自动创建的证书，其他节点先别通过启动创建证书。</p><div class="hint-container danger"><p class="hint-container-title">警告</p><p>不要再手动创建证书了，从ES8.4（也许更早）版本开始，证书是自动创建的，手动创建的证书可能会发生冲突。如下图，启动ES时，自动创建certs目录，并创建了3个证书</p></div><p>创建的证书如下：</p><figure><img src="/java-doc/img/sql/es/4-3-6.jpg" alt="4-3-6" tabindex="0" loading="lazy"><figcaption>4-3-6</figcaption></figure><ul><li>http.p12：ssl证书，用与http的SSL通信</li><li>http_ca.crt：ca证书</li><li>transports.p12：节点证书，用于集群节点见通信</li></ul><h4 id="_3-自动修改配置文件" tabindex="-1"><a class="header-anchor" href="#_3-自动修改配置文件" aria-hidden="true">#</a> 3. 自动修改配置文件</h4><p>第一次启动ES后，会自动开启安全配置功能，并修改配置文件，添加安全类配置：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># Enable security features</span>
<span class="token comment">## 1. 激活安全验证能模块</span>
<span class="token key atrule">xpack.security.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">xpack.security.enrollment.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># Enable encryption for HTTP API client connections, such as Kibana</span>
<span class="token comment">## 2. 开启SSL验证，所有HTTP API都要进行SSL验证</span>
<span class="token key atrule">xpack.security.http.ssl</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">keystore.path</span><span class="token punctuation">:</span> certs/http.p12 <span class="token comment"># 索引的证书</span>

<span class="token comment"># Enable encryption and mutual authentication between cluster nodes</span>
<span class="token comment">## 3.开启集群节点间的加密和相互认证功能</span>
<span class="token key atrule">xpack.security.transport.ssl</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">verification_mode</span><span class="token punctuation">:</span> certificate
  <span class="token key atrule">keystore.path</span><span class="token punctuation">:</span> certs/transport.p12 <span class="token comment"># 节点通信的证书</span>
  <span class="token key atrule">truststore.path</span><span class="token punctuation">:</span> certs/transport.p12

<span class="token comment"># Create a new cluster with the current node only</span>
<span class="token comment"># Additional nodes can still join the cluster later</span>
<span class="token comment">## 4. 使用当前节点创建一个新集群，主节点就是当前主机名</span>
<span class="token comment">## 其他节点随后可以加入该节点</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;tx-1&quot;</span><span class="token punctuation">]</span>

<span class="token comment"># Allow HTTP API connections from anywhere</span>
<span class="token comment"># Connections are encrypted and require user authentication</span>
<span class="token comment">## 5. 允许所有IP访问 HTTP API </span>
<span class="token key atrule">http.host</span><span class="token punctuation">:</span> 0.0.0.0

<span class="token comment"># Allow other nodes to join the cluster from anywhere</span>
<span class="token comment"># Connections are encrypted and mutually authenticated</span>
<span class="token comment"># 6. 节点通信配置：该配置允许其他任何ip的节点加入该集群，默认是没有开启的。</span>
<span class="token comment">#transport.host: 0.0.0.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-返回授权信息" tabindex="-1"><a class="header-anchor" href="#_4-返回授权信息" aria-hidden="true">#</a> 4. 返回授权信息</h4><p>开启安全配置功能，还会启用身份认证和授权，并将授权信息返回。</p><p>返回的内容如下：</p><p>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p><p>✅ Elasticsearch security features have been automatically configured!</p><p>✅ Authentication is enabled and cluster connections are encrypted.</p><p>ℹ️ Password for the elastic user (reset with <code>bin/elasticsearch-reset-password -u elastic</code>):</p><p><em>IXlAmG6eb1V57*bN72gx</em></p><p>ℹ️ HTTP CA certificate SHA-256 fingerprint:</p><p><em>050f72bcd20a7a53ac68cb37663c37d318f1e71af2c8c98b16e58dcdfa83909c</em></p><p>ℹ️ Configure Kibana to use this cluster:</p><ul><li>Run Kibana and click the configuration link in the terminal when Kibana starts.</li><li>Copy the following enrollment token and paste it into Kibana in your browser (valid for the next 30 minutes):</li></ul><p><em>eyJ2ZXIiOiI4LjcuMCIsImFkciI6WyIxNzIuMTYuMC45OjkyMDAiXSwiZmdyIjoiMDUwZjcyYmNkMjBhN2E1M2FjNjhjYjM3NjYzYzM3ZDMxOGYxZTcxYWYyYzhjOThiMTZlNThkY2RmYTgzOTA5YyIsImtleSI6IlNDTmNHb2tCTWlMRHlaaVVYUTNGOnZibmJUdUFLUjhTRjZ1aXVHU0xZTlEifQ==</em></p><p>ℹ️ Configure other nodes to join this cluster:</p><ul><li>On this node: <ul><li>Create an enrollment token with <code>bin/elasticsearch-create-enrollment-token -s node</code>.</li><li>Uncomment the transport.host setting at the end of config/elasticsearch.yml.</li><li>Restart Elasticsearch.</li></ul></li><li>On other nodes: <ul><li>Start Elasticsearch with <code>bin/elasticsearch --enrollment-token &lt;token&gt;</code>, using the enrollment token that you generated.</li></ul></li></ul><p>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p><h5 id="信息总结" tabindex="-1"><a class="header-anchor" href="#信息总结" aria-hidden="true">#</a> 信息总结：</h5><ul><li>用户名：elastic（这个用户是超级用户，系统内置的用户名）</li><li>密码：xbqtuCmjMmlU6b_OXhsg</li><li>Kibana token：用于配置Kibana，有效时间30分钟</li><li>其他节点加入该集群的步骤 <ul><li>在该节点上： <ul><li>创建一个注册token</li><li>修稿配置文件中的：transport.host，允许其他节点加入</li><li>重启当前ES节点</li></ul></li><li>在新的节点上 <ul><li>修改配置文件</li><li>在启动节点时，使用主节点产生的注册token</li></ul></li></ul></li></ul><h4 id="_5-验证节点" tabindex="-1"><a class="header-anchor" href="#_5-验证节点" aria-hidden="true">#</a> 5. 验证节点</h4><p>登录主节点，查看主节点状态。</p><p>输入<code>https://ip或hostname:端口号/</code> 进行访问</p><p>当前配置的URL： <a href="https://159.75.225.162:9200/" target="_blank" rel="noopener noreferrer">https://159.75.225.162:9200/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> （没有主机映射，就直接用ip访问了）</p><p>第一次访问要输入账号和密码，就是第一次启动ES时返回的账号密码（换一个客户端就要输一次密码）。</p><figure><img src="/java-doc/img/sql/es/4-3-4.jpg" alt="4-3-4" tabindex="0" loading="lazy"><figcaption>4-3-4</figcaption></figure><p>登录后的页面：</p><figure><img src="/java-doc/img/sql/es/4-3-5.jpg" alt="4-3-5" tabindex="0" loading="lazy"><figcaption>4-3-5</figcaption></figure><p>这表示服务正常启动，且能访问了，其他两个节点也可以这样启动一遍验证节点是否可用。</p><h2 id="创建集群" tabindex="-1"><a class="header-anchor" href="#创建集群" aria-hidden="true">#</a> 创建集群</h2><h4 id="_1-主节点-修改配置文件" tabindex="-1"><a class="header-anchor" href="#_1-主节点-修改配置文件" aria-hidden="true">#</a> 1. 主节点：修改配置文件</h4><p>在主节点上修改集群配置信息、开放其他节点的访问。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> es<span class="token punctuation">-</span>com
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token key atrule">node.roles</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">,</span>data<span class="token punctuation">]</span> 
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /opt/es/elasticsearch<span class="token punctuation">-</span>8.7.0/data
<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> /opt/es/elasticsearch<span class="token punctuation">-</span>8.7.0/logs
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 0.0.0.0
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
<span class="token key atrule">transport.host</span><span class="token punctuation">:</span> 0.0.0.0
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;159.75.225.162&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;120.79.149.95&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;52.194.241.105&quot;</span><span class="token punctuation">]</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-主节点-生成注册token" tabindex="-1"><a class="header-anchor" href="#_1-主节点-生成注册token" aria-hidden="true">#</a> 1. 主节点：生成注册token</h4><div class="hint-container warning"><p class="hint-container-title">注意</p><ul><li>生成token时，要保证主节点正常运行。</li><li>生成token要发生在修改配置文件之后，主节点配置文件修改了，就要重新生成token</li></ul></div><p>在主节点上生成注册token，用于其他节点启动时加入该节点</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /opt/es/elasticsearch-8.7.0/bin
./elasticsearch-create-enrollment-token <span class="token parameter variable">-s</span> <span class="token function">node</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>返回了一个token字符串：</p><p><em>eyJ2ZXIiOiI4LjcuMCIsImFkciI6WyIxNzIuMTYuMC45OjkyMDAiXSwiZmdyIjoiMDUwZjcyYmNkMjBhN2E1M2FjNjhjYjM3NjYzYzM3ZDMxOGYxZTcxYWYyYzhjOThiMTZlNThkY2RmYTgzOTA5YyIsImtleSI6IncwUE1Hb2tCOFBVZWxlWWs0VFlZOmY2aFF6dHVQUTV1OU4xVURPZHh5TXcifQ==</em></p><h4 id="_2-新节点-启动节点-附加注册token" tabindex="-1"><a class="header-anchor" href="#_2-新节点-启动节点-附加注册token" aria-hidden="true">#</a> 2. 新节点：启动节点，附加注册token</h4><h5 id="debug" tabindex="-1"><a class="header-anchor" href="#debug" aria-hidden="true">#</a> debug</h5><ul><li>token 失效： <ul><li>报错：Aborting enrolling to cluster. Could not communicate with the node on any of the addresses from the enrollment token. All of [172.16.0.9:9200] were attempted.</li><li>解决：使用主节点重新生成一个token</li></ul></li></ul><h2 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件" aria-hidden="true">#</a> 配置文件</h2><p>修改主配置文件：config/elasticsearch.yml，三台机器要分别修改。</p><p>注意修改的配置项说明：</p><ul><li>名称 <ul><li><a href="http://cluster.name" target="_blank" rel="noopener noreferrer">cluster.name<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：集群名称，节点之间要保持一致</li><li><a href="http://node.name" target="_blank" rel="noopener noreferrer">node.name<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：节点名称，集群内要唯一 <ul><li>如果不配置，就默认是当前主机的hostname</li></ul></li></ul></li><li>IP <ul><li>network.host：允许访问es服务的IP地址。 <ul><li>默认：localhost，即：仅运行当前ip访问</li><li><code>0.0.0.0</code>：表示所有服务器都可以访问，需要配置安全信息</li></ul></li><li>http.port：ES服务的端口，默认是9200</li></ul></li><li>目录 <ul><li>path.data：索引数据的目录</li><li>path.logs：日志所在目录</li></ul></li><li>集群 <ul><li>transport.port：TCP 监听端口，用于节点内部通信 <ul><li>不用配置，默认就是9300</li></ul></li><li>discovery.seed_hosts：被查询发现的其他节点的 <ul><li>只需要配置其他节点的ip即可，默认会使用transport.port进行通信</li></ul></li><li>cluster.initial_master_nodes：初始主节点 <ul><li>开启一个全新的集群时，会有一个集群的引导步骤，这步骤用来确定哪些节点参与第一次的主节点选举</li><li>做法：在第一个启动的节点处配置，配置是当前节点的hostname（<a href="http://xn--node-475h.name" target="_blank" rel="noopener noreferrer">或node.name<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）</li><li>该配置仅在第一次启动集群有效，其他节点加入集群，或重启集群都是无效的，可以注释掉。</li></ul></li></ul></li></ul><h4 id="_1-tx-1-node-1" tabindex="-1"><a class="header-anchor" href="#_1-tx-1-node-1" aria-hidden="true">#</a> 1. tx-1：node-1</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># ES文件和日志的目录</span>
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /opt/es/elasticsearch<span class="token punctuation">-</span>8.7.0/data
<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> /opt/es/elasticsearch<span class="token punctuation">-</span>8.7.0/logs

<span class="token comment"># 生产时：不设置或localhost = 仅允许本机访问，更安全，</span>
<span class="token comment"># 开发时：0.0.0.0 = 允许网络上所有的主机访问ES服务</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 0.0.0.0 <span class="token comment"># 开发时设置成</span>

<span class="token comment"># 端口，默认就是9200，不设置也可以</span>
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-启动es" tabindex="-1"><a class="header-anchor" href="#_1-启动es" aria-hidden="true">#</a> 1. 启动ES</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 启动服务</span>
<span class="token builtin class-name">cd</span> /opt/es/elasticsearch-8.7.0/
bin/elasticsearch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-守护进程" tabindex="-1"><a class="header-anchor" href="#_2-守护进程" aria-hidden="true">#</a> 2. 守护进程</h4><p>ES默认启动的方式是前台启动，第一次前台启动为了获取密码信息，之后可以选择守护进程的方式启动</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">su</span> es
<span class="token builtin class-name">cd</span> /opt/es/elasticsearch-8.7.0/

<span class="token comment"># 后台启动服务</span>
bin/elasticsearch <span class="token parameter variable">-d</span>

<span class="token comment"># 重启服务：重复启动命令就会重启</span>

<span class="token comment"># 停止ES运行：查询ES的pid，然后手动kill</span>
<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> elastic 
<span class="token function">kill</span> <span class="token parameter variable">-9</span> pid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="debug-1" tabindex="-1"><a class="header-anchor" href="#debug-1" aria-hidden="true">#</a> debug</h2><p>一些启动时可能会出现的问题。</p><h4 id="_1-默认jvm内存过大" tabindex="-1"><a class="header-anchor" href="#_1-默认jvm内存过大" aria-hidden="true">#</a> 1. 默认JVM内存过大</h4><p>ES内置JVM的默认内存是4G。</p><p>如果Linux服务器剩余内存过小，就会直接卡死，可以按照优化章节的内容重新配置内存</p><p>ES 目录的 config/jvm.options文件是用来配置内存的。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">################################################################</span>
<span class="token comment">## IMPORTANT: JVM heap size</span>
<span class="token comment">################################################################</span>
<span class="token comment">## -Xms4g</span>
<span class="token comment">## -Xmx4g</span>
<span class="token punctuation">-</span>Xms1g  <span class="token comment"># 初始启动大小</span>
<span class="token punctuation">-</span>Xmx1g  <span class="token comment"># 可分配的最大内置值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-虚拟内存过小" tabindex="-1"><a class="header-anchor" href="#_2-虚拟内存过小" aria-hidden="true">#</a> 2. 虚拟内存过小</h4><p>报错：<code>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</code>，虚拟内存过小，只有65530，至少需要262144</p><p>将虚拟内存修改层262144</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看当前虚拟内存</span>
<span class="token function">cat</span> /proc/sys/vm/max_map_count <span class="token comment"># 65530 </span>

<span class="token comment"># 修改虚拟内存</span>
<span class="token function">sudo</span> <span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">vm.max_map_count</span><span class="token operator">=</span><span class="token number">262144</span> <span class="token comment"># vm.max_map_count=262144</span>

<span class="token comment"># 再次查看当前内存</span>
<span class="token function">cat</span> /proc/sys/vm/max_map_count <span class="token comment"># 262144</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>PS :主机若进行了重启，就要重新修改虚拟内存</p><h4 id="_3-协议错误" tabindex="-1"><a class="header-anchor" href="#_3-协议错误" aria-hidden="true">#</a> 3. 协议错误</h4><ul><li>报错：received plaintext http traffic on an https chann<br> 配置了ssl，就要用https访问，而不是http</li></ul><h4 id="_4-忘记密码" tabindex="-1"><a class="header-anchor" href="#_4-忘记密码" aria-hidden="true">#</a> 4. 忘记密码</h4><p>第一次启动ES会返回密码信息，如果没有保存，可以采用指令重置密码</p><p>PS: 用户名默认是elastic</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /opt/es/elasticsearch-8.7.0/
bin/elasticsearch-reset-password <span class="token parameter variable">-u</span> elastic
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-权限不够" tabindex="-1"><a class="header-anchor" href="#_5-权限不够" aria-hidden="true">#</a> 5. 权限不够</h4><p>Exception in thread &quot;main&quot; java.nio.file.AccessDeniedException: /opt/es/elasticsearch-8.7.0/config/elasticsearch.keystore</p><h4 id="证书错误" tabindex="-1"><a class="header-anchor" href="#证书错误" aria-hidden="true">#</a> 证书错误</h4><p>http client did not trust this server&#39;s certificate</p><h4 id="该节点是单节点" tabindex="-1"><a class="header-anchor" href="#该节点是单节点" aria-hidden="true">#</a> 该节点是单节点</h4><p>setting. Fully-formed clusters do not attempt to discover other nodes, and nodes with different cluster UUIDs cannot belong to the same cluster. The cluster UUID persists across restarts and can only be changed by deleting the contents of the node&#39;s data path(s). Remove the discovery configuration to suppress this message</p><p>Aborting enrolling to cluster. Could not communicate with the node on any of the addresses from the enrollment token. All of [172.16.0.9:9200] were attempted</p><h4 id="默认线程数太少-要修改成4080" tabindex="-1"><a class="header-anchor" href="#默认线程数太少-要修改成4080" aria-hidden="true">#</a> 默认线程数太少，要修改成4080</h4><p>max number of threads [3565] for user [ec2-user] is too low, increase to at least [4096]</p><h4 id="端口限制" tabindex="-1"><a class="header-anchor" href="#端口限制" aria-hidden="true">#</a> 端口限制</h4><p>有些云平台的主机看似关闭了防火墙，但平台网关其实开启了防火墙，且是以白名单的形式，比如阿里云。此时9200端口是禁止访问的，在主机上查看防火墙是关闭状态，这只能在云平台的安全组中进行设置。</p><p>✅ Elasticsearch security features have been automatically configured!<br> ✅ Authentication is enabled and cluster connections are encrypted.</p><p>ℹ️ Password for the elastic user (reset with <code>bin/elasticsearch-reset-password -u elastic</code>):<br> -uQ_FdpGQciNEVmrfkCO</p><p>ℹ️ HTTP CA certificate SHA-256 fingerprint:<br> dfb3773530997b415a608511f7c540c073ceabe1a780bd630434f61db4f33760</p><p>ℹ️ Configure Kibana to use this cluster:<br> • Run Kibana and click the configuration link in the terminal when Kibana starts.<br> • Copy the following enrollment token and paste it into Kibana in your browser (valid for the next 30 minutes):<br> eyJ2ZXIiOiI4LjcuMCIsImFkciI6WyIxNzIuMTYuMC45OjkyMDAiXSwiZmdyIjoiZGZiMzc3MzUzMDk5N2I0MTVhNjA4NTExZjdjNTQwYzA3M2NlYWJlMWE3ODBiZDYzMDQzNGY2MWRiNGYzMzc2MCIsImtleSI6Ind6UDhISWtCS1pTVUhBenFEWFljOnB1YTJSU2JCVEl5OUpKMmZTcDBmSlEifQ==</p><p>ℹ️ Configure other nodes to join this cluster:<br> • Copy the following enrollment token and start new Elasticsearch nodes with <code>bin/elasticsearch --enrollment-token &lt;token&gt;</code> (valid for the next 30 minutes):<br> eyJ2ZXIiOiI4LjcuMCIsImFkciI6WyIxNzIuMTYuMC45OjkyMDAiXSwiZmdyIjoiZGZiMzc3MzUzMDk5N2I0MTVhNjA4NTExZjdjNTQwYzA3M2NlYWJlMWE3ODBiZDYzMDQzNGY2MWRiNGYzMzc2MCIsImtleSI6InhUUDhISWtCS1pTVUhBenFEWFloOjFicFp5YlI5UmNTQUlCTzJlanh3QVEifQ==</p><p>If you&#39;re running in Docker, copy the enrollment token and run:<br><code>docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.7.0</code></p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="vp-link nav-link prev" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->4-3. Linux 单机</div></a><a class="vp-link nav-link next" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-5.Kibana.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">4-5. Kibana<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Victor Da V</div><div class="vp-copyright">Copyright © Free To Copy</div></footer></div><!--]--><!----><!----><!----><!--]--></div>
    <script type="module" src="/java-doc/assets/app-23bfaf90.js" defer></script>
  </body>
</html>
