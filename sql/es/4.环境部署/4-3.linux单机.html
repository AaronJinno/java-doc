<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.63" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://aicell.cc/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html"><meta property="og:site_name" content="Java全栈"><meta property="og:title" content="4-3. Linux 单机"><meta property="og:description" content="整体步骤 安装; 下载Elasticsearch 8.7.0; 上传到服务器：/opt/soft-bar/; 解压到：/opt/es/（此时ES软件目录为：/opt/es/es-8.7.0/）; 补齐目录：es-8.7.0/data和`es-8.7.0/certs; 创建es用户：创建一个专门的用户es，用来启动es服务; 证书：千万不要再签发证书了，..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-07-03T11:04:53.000Z"><meta property="article:author" content="Victor Da V"><meta property="article:published_time" content="2023-06-28T00:00:00.000Z"><meta property="article:modified_time" content="2023-07-03T11:04:53.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"4-3. Linux 单机","image":[""],"datePublished":"2023-06-28T00:00:00.000Z","dateModified":"2023-07-03T11:04:53.000Z","author":[{"@type":"Person","name":"Victor Da V","url":"https://aicell.cc/about"}]}</script><link rel="icon" href="/java-doc/favicon.svg"><link rel="manifest" href="/java-doc/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>4-3. Linux 单机 | Java全栈</title><meta name="description" content="整体步骤 安装; 下载Elasticsearch 8.7.0; 上传到服务器：/opt/soft-bar/; 解压到：/opt/es/（此时ES软件目录为：/opt/es/es-8.7.0/）; 补齐目录：es-8.7.0/data和`es-8.7.0/certs; 创建es用户：创建一个专门的用户es，用来启动es服务; 证书：千万不要再签发证书了，...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/java-doc/assets/style-f6ee4914.css" as="style"><link rel="stylesheet" href="/java-doc/assets/style-f6ee4914.css">
    <link rel="modulepreload" href="/java-doc/assets/app-a9d52fc3.js"><link rel="modulepreload" href="/java-doc/assets/4-3.linux单机.html-420ec285.js"><link rel="modulepreload" href="/java-doc/assets/4-3-4-41bab6ef.js"><link rel="modulepreload" href="/java-doc/assets/4-3.linux单机.html-9c9216ce.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/java-doc/"><img class="vp-nav-logo" src="/java-doc/logo.svg" alt="Java全栈"><!----><span class="vp-site-name hide-in-pad">Java全栈</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/java-doc/guide/"><span class="font-icon icon iconfont icon-zhinan" style=""></span>指南<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Java"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/javase/"><span class="font-icon icon iconfont icon-java" style=""></span>JavaSE<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/javaweb/"><span class="font-icon icon iconfont icon-java1" style=""></span>JavaWeb<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/jvm/"><span class="font-icon icon iconfont icon-JVM" style=""></span>JVM<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/func/"><span class="font-icon icon iconfont icon-java3" style=""></span>内置资源<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/idea/"><span class="font-icon icon iconfont icon-Idea" style=""></span>IDEA<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="框架"><span class="title"><span class="font-icon icon iconfont icon-SPRINGMVC" style=""></span>框架</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>依赖管理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/maven/"><span class="font-icon icon iconfont icon-maven" style=""></span>Maven<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>SSM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/spring/"><span class="font-icon icon iconfont icon-SPRINGMVC" style=""></span>Sping<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/springmvc/"><span class="font-icon icon iconfont icon-spring" style=""></span>SpringMVC<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/mybatis/"><span class="font-icon icon iconfont icon-MYBATIS" style=""></span>MyBatis<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/mybatisplus/"><span class="font-icon icon iconfont icon-mybatis-plus" style=""></span>MyBatisPlus<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>开发框架</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/springboot/"><span class="font-icon icon iconfont icon-SPRINGBOOT" style=""></span>SpringBoot<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="中间件"><span class="title"><span class="font-icon icon iconfont icon-jimu" style=""></span>中间件</span><span class="arrow"></span><ul class="nav-dropdown"></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="微服务"><span class="title"><span class="font-icon icon iconfont icon-weifuwu" style=""></span>微服务</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/sc/"><span class="font-icon icon iconfont icon-spring-cloud" style=""></span>SpringCloud &amp; Alibaba<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/nacos/"><span class="font-icon icon iconfont icon-Nacos" style=""></span>Nacos<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/gateway/"><span class="font-icon icon iconfont icon-gateway" style=""></span>Gateway<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/openfeign/"><span class="font-icon icon iconfont icon-http" style=""></span>OpenFeign<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/Seata/"><span class="font-icon icon iconfont icon-seat-a-select" style=""></span>Seata<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/sentinel/"><span class="font-icon icon iconfont icon-sentinel" style=""></span>Sentinel<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/old/"><span class="font-icon icon iconfont icon-jinggao" style=""></span>过时组件<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="SQL"><span class="title"><span class="font-icon icon iconfont icon-sql" style=""></span>SQL</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/mysql/"><span class="font-icon icon iconfont icon-xingzhuang" style=""></span>MySQL<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/redis/"><span class="font-icon icon iconfont icon-redis" style=""></span>Redis<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/mongodb/"><span class="font-icon icon iconfont icon-connection-MongoDB" style=""></span>MongoDB<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/memcache/"><span class="font-icon icon iconfont icon-memcacheyunshujukuMemcac" style=""></span>Memcache<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link active" href="/java-doc/sql/es/"><span class="font-icon icon iconfont icon-elasticsearch-Elasticsearch" style=""></span>ES<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="服务器"><span class="title"><span class="font-icon icon iconfont icon-database" style=""></span>服务器</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/linux/"><span class="font-icon icon iconfont icon-linux__easyiconnet" style=""></span>Linux<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/shell/"><span class="font-icon icon iconfont icon-powershell" style=""></span>shell<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/nginx/"><span class="font-icon icon iconfont icon-nginx" style=""></span>Nginx<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/docker/"><span class="font-icon icon iconfont icon-Docker" style=""></span>Docker<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="轮子"><span class="title"><span class="font-icon icon iconfont icon-zujiancaozuozujianfuxuankuangxuanzhong" style=""></span>轮子</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/blocks/rouyi/"><span class="font-icon icon iconfont icon-guihuaheshi" style=""></span>若依rouyi<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="dev"><span class="title"><span class="font-icon icon iconfont icon-kaifa1" style=""></span>dev</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/dev/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"><span class="font-icon icon iconfont icon-xinshouzhinan" style=""></span>项目开发指南<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="项目"><span class="title"><span class="font-icon icon iconfont icon-shixushujuku" style=""></span>项目</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/item/learn/"><span class="font-icon icon iconfont icon-xinshouzhinan" style=""></span>学习项目<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="其他"><span class="title"><span class="font-icon icon iconfont icon-qita" style=""></span>其他</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>工具</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other/git/"><span class="font-icon icon iconfont icon-git" style=""></span>Git<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>理论</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other/mode.html"><span class="font-icon icon iconfont icon-shejimoshi" style=""></span>设计模式<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>专业与通用技术</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other/regex.html"><span class="font-icon icon iconfont icon-zhengzebiaodashi" style=""></span>正则<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>插件</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other//plugin/swagger/"><span class="font-icon icon iconfont icon-swagger" style=""></span>swagger<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-xingzhuang" style=""></span><span class="vp-sidebar-title">         MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-redis" style=""></span><span class="vp-sidebar-title">        Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-memcacheyunshujukuMemcac" style=""></span><span class="vp-sidebar-title">    Memcache</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-connection-MongoDB" style=""></span><span class="vp-sidebar-title">    MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-elasticsearch-Elasticsearch" style=""></span><span class="vp-sidebar-title">ElasticSearch</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/map.html"><!---->     -&gt;Map<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">1.ES入门</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">2.HTTP操作</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">3.Java操作ES</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">4.环境部署</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-1.%E5%8D%95%E6%9C%BA%E4%B8%8E%E9%9B%86%E7%BE%A4.html"><!---->4-1. 单机与集群<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-2.windows%E9%9B%86%E7%BE%A4.html"><!---->4-2. windows集群<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html"><!---->4-3. Linux 单机<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html#整体步骤"><!---->整体步骤<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html#安装"><!---->安装<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html#ca证书"><!---->CA证书<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html#配置文件"><!---->配置文件<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html#启动es"><!---->启动ES<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-3.linux%E5%8D%95%E6%9C%BA.html#debug"><!---->debug<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-4.Linux%E9%9B%86%E7%BE%A4.html"><!---->4-4. Linux集群<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-5.Kibana.html"><!---->4-5. Kibana<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-6.%E9%87%8D%E8%A6%81%E9%85%8D%E7%BD%AE.html"><!---->4-6. 重要配置<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">5.底层原理</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">7.优化</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">x.dev</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->4-3. Linux 单机</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://aicell.cc/about" target="_blank" rel="noopener noreferrer">Victor Da V</a></span><span property="author" content="Victor Da V"></span></span><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-06-28T00:00:00.000Z"></span><!----><!----><span class="page-word-info" aria-label="字数🔠" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 3212 字</span><meta property="wordCount" content="3212"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#整体步骤">整体步骤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#安装">安装</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#ca证书">CA证书</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#配置文件">配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#启动es">启动ES</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#debug">debug</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="整体步骤" tabindex="-1"><a class="header-anchor" href="#整体步骤" aria-hidden="true">#</a> 整体步骤</h2><ul><li>安装 <ul><li>下载Elasticsearch 8.7.0</li><li>上传到服务器：/opt/soft-bar/</li><li>解压到：/opt/es/（此时ES软件目录为：<code>/opt/es/es-8.7.0/</code>）</li><li>补齐目录：<code>es-8.7.0/data</code>和<code>es-8.7.0/certs</code></li><li>创建es用户：创建一个专门的用户es，用来启动es服务</li></ul></li><li>证书：千万不要再签发证书了，新版本的ES是自动签发证书的</li><li>配置：config/elasticsearch.yml <ul><li>一些基本的配置，因为不是集群，所以不用配置集群信息</li></ul></li><li>启动 <ul><li>debug：有很多bug要提前解决</li><li>启动：常见bug解决后再进行启动</li><li>访问：启动后就可以在浏览器端访问了</li></ul></li></ul><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h2><p>ES8需要Java17，不过ES8会默认会捆绑JDK，所以不配置Java环境也可以。</p><h4 id="_1-下载es" tabindex="-1"><a class="header-anchor" href="#_1-下载es" aria-hidden="true">#</a> 1. 下载ES</h4><ul><li>下载地址：<a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch" target="_blank" rel="noopener noreferrer">LINUX_X86_64<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>可以在本地下载上传到服务器，也可以直接在服务器进行wget下载。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.7.0-linux-x86_64.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-上传安装包-规划目录" tabindex="-1"><a class="header-anchor" href="#_2-上传安装包-规划目录" aria-hidden="true">#</a> 2. 上传安装包，规划目录</h4><ul><li>上传目录：<code>/opt/soft-bar/</code>，该目录用来存放安装包</li><li>工作目录：<code>/opt/es/</code>：该目录存放所有ES相关的内容 <ul><li>解压目录：<code>/opt/es/es-8.7.0/</code></li><li>其他ES文件也都放在该目录下，包括Kibana</li></ul></li></ul><h5 id="_3-解压缩" tabindex="-1"><a class="header-anchor" href="#_3-解压缩" aria-hidden="true">#</a> 3. 解压缩</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /opt/soft-bar
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> elasticsearch-8.7.0-linux-x86_64.tar.gz <span class="token parameter variable">-C</span> /opt/es
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>解压后的目录结构：</p><figure><img src="/java-doc/img/sql/es/4-3-1.jpg" alt="4-3-1" tabindex="0" loading="lazy"><figcaption>4-3-1</figcaption></figure><ul><li>bin：可执行脚本目录</li><li>config：配置目录</li><li>jdk：内置JDK</li><li>lib：内置类库</li><li>logs：日志目录</li><li>modules：模块目录</li><li>plugins：插件目录</li></ul><h5 id="_4-补齐目录" tabindex="-1"><a class="header-anchor" href="#_4-补齐目录" aria-hidden="true">#</a> 4. 补齐目录</h5><p>解压后的目录结构还缺一个数据文件目录和证书目录。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>不用补齐，这俩目录都会自动创建</p></div><h4 id="_5-创建es用户" tabindex="-1"><a class="header-anchor" href="#_5-创建es用户" aria-hidden="true">#</a> 5. 创建es用户</h4><p>Elasticsearch 不能使用 root用户启动，因此要创建一个名为es的用户操作Elasticsearch。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">useradd</span> es <span class="token comment"># 创建用户</span>
<span class="token function">passwd</span> es <span class="token comment"># 设置密码，回车输入密码，这里暂密码暂定为es</span>
<span class="token function">chown</span> <span class="token parameter variable">-R</span> es:es /opt/es/elasticsearch-8.7.0 <span class="token comment"># 修改文件拥有者</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ca证书" tabindex="-1"><a class="header-anchor" href="#ca证书" aria-hidden="true">#</a> CA证书</h2><div class="hint-container danger"><p class="hint-container-title">警告</p><p>不要再创建证书了，从ES8.4（也许更早）版本开始，证书是自动创建的，手动创建的证书可能会发生冲突，以下创建证书的步骤依然保留，但实际开发中不要创建。</p><p>如下图，启动ES时，自动创建certs目录，并创建了3个证书</p><figure><img src="/java-doc/img/sql/es/4-3-6.jpg" alt="4-3-6" tabindex="0" loading="lazy"><figcaption>4-3-6</figcaption></figure></div><p>证书是用来进行身份验证，防止请求被篡改的。不使用证书可能会报错。</p><p>ES通过内置的elasticsearch-certutil工具来生成证书。</p><h4 id="_1-ca模式。" tabindex="-1"><a class="header-anchor" href="#_1-ca模式。" aria-hidden="true">#</a> 1. CA模式。</h4><p>创建证书有四种模式：ca、cert、csr、http，我们这里采用CA模式</p><ul><li>CA模式生成新的证书颁发机构(ca)。默认情况下，它生成一个PKCS#12输出文件，其中保存CA证书和CA的私钥。</li><li>也可以指定–pem参数，则命令生成一个zip文件，其中包含PEM格式的证书和私钥。随后可以使用这些文件作为命令的cert模式的输入。</li><li>PKCS#12文件：一种交换数字证书的加密标准。通常用它来加密打包一个私钥及有关的 X.509 证书，产生的文件就是PKCS#12文件。</li></ul><h4 id="_2-ca证书" tabindex="-1"><a class="header-anchor" href="#_2-ca证书" aria-hidden="true">#</a> 2. CA证书</h4><ul><li>证书：用来证明受访问的服务身份信息。</li><li>签名：存在证书上的一个可信标识，代表该证书是经过认证的，因为假冒服务器也可以有证书。</li><li>CA证书：是公认可靠的CA(certificate authority)机构签发的证书</li></ul><figure><img src="/java-doc/img/sql/es/4-3-2.jpg" alt="4-3-2" tabindex="0" loading="lazy"><figcaption>4-3-2</figcaption></figure><h4 id="_3-ca证书工作机理" tabindex="-1"><a class="header-anchor" href="#_3-ca证书工作机理" aria-hidden="true">#</a> 3. CA证书工作机理</h4><p>通过HTTPS请求的步骤来说明CA证书的工作机理</p><ul><li>浏览器发起https请求</li><li>服务器返回它的证书</li><li>浏览器通过CA的公钥对证书签名进行校验，检查证书是否有效</li><li>浏览器生成一个临时秘钥并用服务器的公钥对它加密，然后将其发送给服务器。</li><li>服务器用私钥解密，得到浏览器发送给它的秘钥， 然后用该秘钥对数据进行加密</li><li>浏览器得到加密数据，并用发给服务端的秘钥进行解密。</li></ul><figure><img src="/java-doc/img/sql/es/4-3-3.jpg" alt="4-3-3" tabindex="0" loading="lazy"><figcaption>4-3-3</figcaption></figure><h4 id="_4-签发ca证书" tabindex="-1"><a class="header-anchor" href="#_4-签发ca证书" aria-hidden="true">#</a> 4. 签发ca证书</h4><div class="hint-container danger"><p class="hint-container-title">警告</p><p>不用签发，启动ES时，会自动签发。这一步不要再做了</p></div><p>需要用到内置的<code>elasticsearch-certutil ca</code> 命令，在 elasticsearch-8.7.0/bin目录中</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">su</span> es <span class="token comment"># 切换用户</span>
<span class="token builtin class-name">cd</span>  /opt/es/elasticsearch-8.7.0/bin <span class="token comment"># 进入bin目录</span>
./elasticsearch-certutil ca <span class="token comment"># 签发 ca 证书</span>

<span class="token comment"># 签发 ca 证书时有两次交互，直接回车即可</span>
<span class="token comment"># 第一次交互：设置文件名，回车采用默认名，默认文件在ES软件根目录中</span>
Please enter the desired output <span class="token function">file</span> <span class="token punctuation">[</span>elastic-stack-ca.p12<span class="token punctuation">]</span>: 
<span class="token comment"># 第二次交互：设置ca证书密码，直接回车将采用空密码，如果设置了要保存后，后续会用</span>
Enter password <span class="token keyword">for</span> elastic-stack-ca.p12 <span class="token builtin class-name">:</span>  <span class="token comment"># 设置密码</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认生成的证书位置：/opt/es/elasticsearch-8.7.0/elastic-stack-ca.p12</p><h4 id="_5-移动证书" tabindex="-1"><a class="header-anchor" href="#_5-移动证书" aria-hidden="true">#</a> 5. 移动证书</h4><div class="hint-container danger"><p class="hint-container-title">警告</p><p>会自动生成证书，这一步不要再做了</p></div><p>生成的证书要放到到config目录内，可以在config目录下创建certs目录用来存放证书。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /opt/es/elasticsearch-8.7.0/config
<span class="token function">mkdir</span> certs
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
<span class="token function">mv</span> elastic-* config/certs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-签发http证书" tabindex="-1"><a class="header-anchor" href="#_6-签发http证书" aria-hidden="true">#</a> 6. 签发HTTP证书</h4><div class="hint-container danger"><p class="hint-container-title">警告</p><p>不用签发，启动ES时，会自动签发。这一步不要再做了</p></div><div class="hint-container danger"><p class="hint-container-title">注意</p><p>注意：使用使用 elasticsearch-certutil 工具自己生成的CA，签发的证书属于自认证证书，该证书浏览器是不不会信任的，需要手动让浏览器信任。</p><p>可以选择使用第三方签发的受信任的证书。</p></div><p>使用CA证书签发HTTP证书，以便可以使用HTTP REST API方式访问ES服务。</p><p>其他组件（例如 Kibana 或任何 Elastic 语言客户端）在连接到 ES服务 时会验证此证书。</p><p>生成证书的流程很复杂，交互很多，如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 用户 和目录同上</span>
./elasticsearch-certutil http

<span class="token comment"># 生成http证书的过程要进行以下10次交互</span>
<span class="token comment">##########################</span>

<span class="token comment"># 第1次: 是否生成证书签名请求</span>
Generate a CSR? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> <span class="token comment"># n</span>

<span class="token comment"># 第2次: 是否要使用现有 CA</span>
Use an existing CA? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> <span class="token comment"># y</span>

<span class="token comment"># 第3次: 指定ca证书的路径：以es软件/config为起始路径</span>
CA Path: <span class="token comment"># certs/elastic-stack-ca.p12 </span>

<span class="token comment"># 第4次: 输入CA证书的密码，之前创建ca证书时未设置，这里直接回车</span>
Password <span class="token keyword">for</span> elastic-stack-ca.p12: <span class="token comment"># 直接回车</span>

<span class="token comment"># 第5次: 证书的生效时间：默认是5y(5年)</span>
For how long should your certificate be valid? <span class="token punctuation">[</span>5y<span class="token punctuation">]</span> <span class="token comment"># 20y </span>

<span class="token comment"># 第6次: 是否为每个节点创建一个单独的证书：不需要，即使是集群也只需主节点创建证书</span>
Generate a certificate per node? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> <span class="token comment"># n</span>

<span class="token comment"># 第7和8是用来配置DNS与证书绑定的：(域名-&gt;ip)：绑定证书</span>

<span class="token comment"># 第7次：输入链接到ES的主机名称（域名） # 如果是集群需要所如所有集群的主机名称</span>
<span class="token comment">## 如果没有DNS解析的主机名（域名），就需要使用本地进行hosts映射，或者直接用IP</span>
aicell.cc <span class="token comment"># 回车一次就可以输入一个名字，两次回车就输入完毕</span>
<span class="token comment">#159.75.225.162 没有被DNS解析的域名，直接用ip，访问的时候用ip访问</span>
Is this correct <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> <span class="token comment">#y，确认名字输入是否正确</span>

<span class="token comment"># 第8次: 输入主机名(域名）解析的ip地址，需要提前进行DNS解析，或hosts映射</span>
<span class="token comment">## 如果是单节点集群，就要指定端口号</span>
<span class="token number">159.75</span>.225.162 <span class="token comment"># 要与主机名对应，</span>
Is this correct <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> <span class="token comment">#y，确认名字输入是否正确</span>


<span class="token comment"># 第9次: 是否对集群中的每个节点重复上述操作，不用</span>
Do you wish to change any of these options? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> <span class="token comment"># n </span>

<span class="token comment"># 第10次: 是否给证书加密</span>
Provide a password <span class="token keyword">for</span> the <span class="token string">&quot;http.p12&quot;</span> file:  <span class="token comment"># 连续回车两次，不加密</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>完成上述10个步骤，证书就生成好了，是一个压缩包，需要解压获取证书。<br> 证书位置：/opt/es/elasticsearch-8.7.0/elasticsearch-ssl-http.zip</p><h4 id="_7-解压并移动http证书" tabindex="-1"><a class="header-anchor" href="#_7-解压并移动http证书" aria-hidden="true">#</a> 7. 解压并移动http证书</h4><div class="hint-container danger"><p class="hint-container-title">警告</p><p>不用签发，启动ES时，会自动签发。这一步不要再做了</p></div><h5 id="_7-1-解压http证书" tabindex="-1"><a class="header-anchor" href="#_7-1-解压http证书" aria-hidden="true">#</a> 7.1 解压http证书</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span>  /opt/es/elasticsearch-8.7.0 
<span class="token function">unzip</span> elasticsearch-ssl-http.zip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>解压后会在<code>/opt/es/elasticsearch-8.7.0/</code> 目录下产生两个信息目录</p><ul><li>elasticsearch：目录内有http.p12证书</li><li>kibana：目录内有elasticsearch-ca.pem证书</li></ul><h5 id="_7-2-移动证书" tabindex="-1"><a class="header-anchor" href="#_7-2-移动证书" aria-hidden="true">#</a> 7.2 移动证书</h5><p>将两个证书移动到certs目录中。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span>  /opt/es/elasticsearch-8.7.0 
<span class="token function">mv</span> elasticsearch/http.p12 kibana/elasticsearch-ca.pem config/certs
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> elasticsearch kibana <span class="token comment"># 删除之前生成的目录</span>
<span class="token function">mv</span> elasticsearch-ssl-http.zip <span class="token punctuation">..</span>/ <span class="token comment"># 将http证书压缩包移动到别的位置，备份</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件" aria-hidden="true">#</a> 配置文件</h2><p>修改主配置文件：config/elasticsearch.yml</p><p>由于是单机ES，很多配置不用开启，基本上所有配置都采用默认即可。</p><h2 id="启动es" tabindex="-1"><a class="header-anchor" href="#启动es" aria-hidden="true">#</a> 启动ES</h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>启动前，最好是先看下debug部分的内容。提前排错。</p></div><h4 id="_1-第一次启动启" tabindex="-1"><a class="header-anchor" href="#_1-第一次启动启" aria-hidden="true">#</a> 1. 第一次启动启</h4><p>第一次启动比较特殊，会额外做三件事：</p><ul><li>返回验证信息：账号、密码、Token等</li><li>创建证书：证书会自动创建</li><li>开启安全模块：开启SSL验证，并自动索引证书，运行其他其他IP访问RESTFul API</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 启动服务</span>
<span class="token builtin class-name">cd</span> /opt/es/elasticsearch-8.7.0/
bin/elasticsearch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-1-返回验证信息" tabindex="-1"><a class="header-anchor" href="#_1-1-返回验证信息" aria-hidden="true">#</a> 1.1 返回验证信息</h5><p>第一次启动控制台打印的验证信息</p><p>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p><p>✅ Elasticsearch security features have been automatically configured!</p><p>✅ Authentication is enabled and cluster connections are encrypted.</p><p>Password for the elastic user (reset with <code>bin/elasticsearch-reset-password -u elastic</code>):</p><p><em>p1V7xKwWO8lgV62_aUfd</em></p><p>HTTP CA certificate SHA-256 fingerprint:</p><p><em>30b920bb03429973b605b035c144f7c51c7df327ec396f85e9db3ad82923157d</em></p><p>Configure Kibana to use this cluster:<br> Run Kibana and click the configuration link in the terminal when Kibana starts.<br> Copy the following enrollment token and paste it into Kibana in your browser (valid for the next 30 minutes):</p><p><em>eyJ2ZXIiOiI4LjcuMCIsImFkciI6WyIxNzIuMTYuMC45OjkyMDAiXSwiZmdyIjoiMzBiOTIwYmIwMzQyOTk3M2I2MDViMDM1YzE0NGY3YzUxYzdkZjMyN2VjMzk2Zjg1ZTlkYjNhZDgyOTIzMTU3ZCIsImtleSI6ImczdTZFSWtCb24xMUUyVjlFTmJoOjFjemlfR2FDVFJtaWswQ1Y5TzJJX1EifQ==</em></p><p>Configure other nodes to join this cluster:<br> Copy the following enrollment token and start new Elasticsearch nodes with <code>bin/elasticsearch --enrollment-token &lt;token&gt;</code> (valid for the next 30 minutes):</p><p><code>eyJ2ZXIiOiI4LjcuMCIsImFkciI6WyIxNzIuMTYuMC45OjkyMDAiXSwiZmdyIjoiMzBiOTIwYmIwMzQyOTk3M2I2MDViMDM1YzE0NGY3YzUxYzdkZjMyN2VjMzk2Zjg1ZTlkYjNhZDgyOTIzMTU3ZCIsImtleSI6ImdYdTZFSWtCb24xMUUyVjlFTmJlOm5xQVR4NWwxUUptdWN1endFeWg1alEifQ==</code></p><p>If you&#39;re running in Docker, copy the enrollment token and run:</p><p><code>docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; </code></p><p><code>docker.elastic.co/elasticsearch/elasticsearch:8.7.0</code><br> ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p><p>上面的内容只会在第一次启动时显示，注意保存里面的内容，尤其是账号和密码</p><ul><li>账号: elastic</li><li>密码: p1V7xKwWO8lgV62_aUfd</li></ul><h5 id="_1-2-创建证书" tabindex="-1"><a class="header-anchor" href="#_1-2-创建证书" aria-hidden="true">#</a> 1.2 创建证书</h5><p>ES会自动创建ca、http和节点通信三个证书，如下：</p><figure><img src="/java-doc/img/sql/es/4-3-6.jpg" alt="4-3-6" tabindex="0" loading="lazy"><figcaption>4-3-6</figcaption></figure><h5 id="_1-3-开启安全模块" tabindex="-1"><a class="header-anchor" href="#_1-3-开启安全模块" aria-hidden="true">#</a> 1.3 开启安全模块</h5><p>ES会自动在配置文件elasticsearch.yaml中添加安全相关的配置</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># Enable security features</span>
<span class="token comment">##  激活安全验证能模块</span>
<span class="token key atrule">xpack.security.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">xpack.security.enrollment.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># Enable encryption for HTTP API client connections, such as Kibana</span>
<span class="token comment">## 开启SSL验证，所有HTTP API都要进行SSL验证</span>
<span class="token key atrule">xpack.security.http.ssl</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">keystore.path</span><span class="token punctuation">:</span> certs/http.p12 <span class="token comment"># 索引的证书</span>

<span class="token comment"># Enable encryption and mutual authentication between cluster nodes</span>
<span class="token comment"># 开启集群节点间的加密和相互认证功能</span>
<span class="token key atrule">xpack.security.transport.ssl</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">verification_mode</span><span class="token punctuation">:</span> certificate
  <span class="token key atrule">keystore.path</span><span class="token punctuation">:</span> certs/transport.p12 <span class="token comment"># 节点通信的证书</span>
  <span class="token key atrule">truststore.path</span><span class="token punctuation">:</span> certs/transport.p12

<span class="token comment"># Create a new cluster with the current node only</span>
<span class="token comment"># Additional nodes can still join the cluster later</span>
<span class="token comment">## 使用当前节点创建一个新集群，主节点就是当前主机名</span>
<span class="token comment">## 其他节点随后可以加入该节点</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;tx-1&quot;</span><span class="token punctuation">]</span>

<span class="token comment"># Allow HTTP API connections from anywhere</span>
<span class="token comment"># Connections are encrypted and require user authentication</span>
<span class="token comment">## 运行所有IP访问 HTTP API </span>
<span class="token key atrule">http.host</span><span class="token punctuation">:</span> 0.0.0.0

<span class="token comment"># Allow other nodes to join the cluster from anywhere</span>
<span class="token comment"># Connections are encrypted and mutually authenticated</span>
<span class="token comment"># 节点通信配置：该配置运行其他任何ip的节点加入该集群，默认是没有开启的。</span>
<span class="token comment">#transport.host: 0.0.0.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-登录es" tabindex="-1"><a class="header-anchor" href="#_2-登录es" aria-hidden="true">#</a> 2. 登录ES</h4><p>输入<code>https://ip或hostname:端口号/</code> 进行访问</p><p>当前配置的URL： <a href="https://159.75.225.162:9200/" target="_blank" rel="noopener noreferrer">https://159.75.225.162:9200/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> （没有主机映射，就直接用ip访问了）</p><p>第一次访问要输入账号和密码，就是第一次启动ES时返回的账号密码（换一个客户端就要输一次密码）。</p><figure><img src="/java-doc/img/sql/es/4-3-4.jpg" alt="4-3-4" tabindex="0" loading="lazy"><figcaption>4-3-4</figcaption></figure><p>登录后的页面：</p><figure><img src="/java-doc/img/sql/es/4-3-5.jpg" alt="4-3-5" tabindex="0" loading="lazy"><figcaption>4-3-5</figcaption></figure><p>则表示服务正常启动，且能访问了。</p><h4 id="_5-其他登录方式" tabindex="-1"><a class="header-anchor" href="#_5-其他登录方式" aria-hidden="true">#</a> 5. 其他登录方式</h4><p>所有登录方式都要进行身份验证。</p><ul><li>postman：以请求头的方式，添加格式化后的账号密码</li><li>kibana：需要验证token</li></ul><h4 id="_4-守护进程" tabindex="-1"><a class="header-anchor" href="#_4-守护进程" aria-hidden="true">#</a> 4. 守护进程</h4><p>ES默认启动的方式是前台启动，第一次前台启动为了获取密码信息，之后可以选择守护进程的方式启动</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">su</span> es
<span class="token builtin class-name">cd</span> /opt/es/elasticsearch-8.7.0/
<span class="token comment"># 后台启动服务</span>
bin/elasticsearch <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="debug" tabindex="-1"><a class="header-anchor" href="#debug" aria-hidden="true">#</a> debug</h2><p>一些启动时可能会出现的问题。</p><h4 id="_1-默认jvm内存过大" tabindex="-1"><a class="header-anchor" href="#_1-默认jvm内存过大" aria-hidden="true">#</a> 1. 默认JVM内存过大</h4><p>ES内置JVM的默认内存是4G。</p><p>如果Linux服务器剩余内存过小，就会直接卡死，可以按照优化章节的内容重新配置内存</p><p>ES 目录的 config/jvm.options文件是用来配置内存的。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">################################################################</span>
<span class="token comment">## IMPORTANT: JVM heap size</span>
<span class="token comment">################################################################</span>
<span class="token comment">## -Xms4g</span>
<span class="token comment">## -Xmx4g</span>
<span class="token punctuation">-</span>Xms1g  <span class="token comment"># 初始启动大小</span>
<span class="token punctuation">-</span>Xmx1g  <span class="token comment"># 可分配的最大内置值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-虚拟内存过小" tabindex="-1"><a class="header-anchor" href="#_2-虚拟内存过小" aria-hidden="true">#</a> 2. 虚拟内存过小</h4><p>报错：<code>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</code>，虚拟内存过小，只有65530，至少需要262144</p><p>将虚拟内存修改层262144</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看当前虚拟内存</span>
<span class="token function">cat</span> /proc/sys/vm/max_map_count <span class="token comment"># 65530 </span>

<span class="token comment"># 修改虚拟内存</span>
<span class="token function">sudo</span> <span class="token function">sysctl</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">vm.max_map_count</span><span class="token operator">=</span><span class="token number">262144</span> <span class="token comment"># vm.max_map_count=262144</span>

<span class="token comment"># 再次查看当前内存</span>
<span class="token function">cat</span> /proc/sys/vm/max_map_count <span class="token comment"># 262144</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-协议错误" tabindex="-1"><a class="header-anchor" href="#_3-协议错误" aria-hidden="true">#</a> 3. 协议错误</h4><ul><li>报错：received plaintext http traffic on an https chann<br> 配置了ssl，就要用https访问，而不是http</li></ul><h4 id="_4-忘记密码" tabindex="-1"><a class="header-anchor" href="#_4-忘记密码" aria-hidden="true">#</a> 4. 忘记密码</h4><p>第一次启动ES会返回密码信息，如果没有保存，可以采用指令重置密码</p><p>PS: 用户名默认是elastic</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /opt/es/elasticsearch-8.7.0/
bin/elasticsearch-reset-password <span class="token parameter variable">-u</span> elastic
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="vp-link nav-link prev" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-2.windows%E9%9B%86%E7%BE%A4.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->4-2. windows集群</div></a><a class="vp-link nav-link next" href="/java-doc/sql/es/4.%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/4-4.Linux%E9%9B%86%E7%BE%A4.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">4-4. Linux集群<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Victor Da V</div><div class="vp-copyright">Copyright © Free To Copy</div></footer></div><!--]--><!----><!----><!----><!--]--></div>
    <script type="module" src="/java-doc/assets/app-a9d52fc3.js" defer></script>
  </body>
</html>
