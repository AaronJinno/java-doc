<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.63" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://aicell.cc/java-doc/sql/es/7.%E4%BC%98%E5%8C%96/7-1.%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96.html"><meta property="og:site_name" content="Java全栈"><meta property="og:title" content="7-1. 基本优化"><meta property="og:description" content="硬件 1. 硬盘 Elasticsearch 的基础是 Lucene，所有的索引和文档数据是存储在本地的磁盘中。 因此磁盘性能是ES最大瓶颈（也计划是所有类型服务器的瓶颈）。Elasticsearch 重度使用磁盘，磁盘能处理的吞吐量越大，节点就越稳定。 一些优化磁盘 I/O 的技巧： 使用 SSD：IO效率是机械盘的10倍以上; 使用RAID 0：可..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-06-30T10:19:04.000Z"><meta property="article:author" content="Victor Da V"><meta property="article:published_time" content="2023-06-30T00:00:00.000Z"><meta property="article:modified_time" content="2023-06-30T10:19:04.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"7-1. 基本优化","image":[""],"datePublished":"2023-06-30T00:00:00.000Z","dateModified":"2023-06-30T10:19:04.000Z","author":[{"@type":"Person","name":"Victor Da V","url":"https://aicell.cc/about"}]}</script><link rel="icon" href="/java-doc/favicon.svg"><link rel="manifest" href="/java-doc/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>7-1. 基本优化 | Java全栈</title><meta name="description" content="硬件 1. 硬盘 Elasticsearch 的基础是 Lucene，所有的索引和文档数据是存储在本地的磁盘中。 因此磁盘性能是ES最大瓶颈（也计划是所有类型服务器的瓶颈）。Elasticsearch 重度使用磁盘，磁盘能处理的吞吐量越大，节点就越稳定。 一些优化磁盘 I/O 的技巧： 使用 SSD：IO效率是机械盘的10倍以上; 使用RAID 0：可...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/java-doc/assets/style-3040979c.css" as="style"><link rel="stylesheet" href="/java-doc/assets/style-3040979c.css">
    <link rel="modulepreload" href="/java-doc/assets/app-23bfaf90.js"><link rel="modulepreload" href="/java-doc/assets/7-1.基本优化.html-8c85fe59.js"><link rel="modulepreload" href="/java-doc/assets/7-1.基本优化.html-41b487ed.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/java-doc/"><img class="vp-nav-logo" src="/java-doc/logo.svg" alt="Java全栈"><!----><span class="vp-site-name hide-in-pad">Java全栈</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/java-doc/guide/"><span class="font-icon icon iconfont icon-zhinan" style=""></span>指南<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Java"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/javase/"><span class="font-icon icon iconfont icon-java" style=""></span>JavaSE<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/javaweb/"><span class="font-icon icon iconfont icon-java1" style=""></span>JavaWeb<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/jvm/"><span class="font-icon icon iconfont icon-JVM" style=""></span>JVM<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/func/"><span class="font-icon icon iconfont icon-java3" style=""></span>内置资源<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/java/idea/"><span class="font-icon icon iconfont icon-Idea" style=""></span>IDEA<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="框架"><span class="title"><span class="font-icon icon iconfont icon-SPRINGMVC" style=""></span>框架</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>依赖管理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/maven/"><span class="font-icon icon iconfont icon-maven" style=""></span>Maven<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>SSM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/spring/"><span class="font-icon icon iconfont icon-SPRINGMVC" style=""></span>Sping<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/springmvc/"><span class="font-icon icon iconfont icon-spring" style=""></span>SpringMVC<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/mybatis/"><span class="font-icon icon iconfont icon-MYBATIS" style=""></span>MyBatis<!----></a></li><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/mybatisplus/"><span class="font-icon icon iconfont icon-mybatis-plus" style=""></span>MyBatisPlus<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>开发框架</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/frame/springboot/"><span class="font-icon icon iconfont icon-SPRINGBOOT" style=""></span>SpringBoot<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="微服务"><span class="title"><span class="font-icon icon iconfont icon-weifuwu" style=""></span>微服务</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/sc/"><span class="font-icon icon iconfont icon-spring-cloud" style=""></span>SpringCloud &amp; Alibaba<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/nacos/"><span class="font-icon icon iconfont icon-Nacos" style=""></span>Nacos<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/gateway/"><span class="font-icon icon iconfont icon-gateway" style=""></span>Gateway<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/openfeign/"><span class="font-icon icon iconfont icon-http" style=""></span>OpenFeign<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/Seata/"><span class="font-icon icon iconfont icon-seat-a-select" style=""></span>Seata<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/sentinel/"><span class="font-icon icon iconfont icon-sentinel" style=""></span>Sentinel<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/cloud/old/"><span class="font-icon icon iconfont icon-jinggao" style=""></span>过时组件<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="SQL"><span class="title"><span class="font-icon icon iconfont icon-sql" style=""></span>SQL</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/mysql/"><span class="font-icon icon iconfont icon-xingzhuang" style=""></span>MySQL<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/redis/"><span class="font-icon icon iconfont icon-redis" style=""></span>Redis<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/mongodb/"><span class="font-icon icon iconfont icon-connection-MongoDB" style=""></span>MongoDB<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/sql/memcache/"><span class="font-icon icon iconfont icon-memcacheyunshujukuMemcac" style=""></span>Memcache<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link active" href="/java-doc/sql/es/"><span class="font-icon icon iconfont icon-elasticsearch-Elasticsearch" style=""></span>ES<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="服务器"><span class="title"><span class="font-icon icon iconfont icon-database" style=""></span>服务器</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/linux/"><span class="font-icon icon iconfont icon-linux__easyiconnet" style=""></span>Linux<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/shell/"><span class="font-icon icon iconfont icon-powershell" style=""></span>shell<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/nginx/"><span class="font-icon icon iconfont icon-nginx" style=""></span>Nginx<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/service/docker/"><span class="font-icon icon iconfont icon-Docker" style=""></span>Docker<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="轮子"><span class="title"><span class="font-icon icon iconfont icon-zujiancaozuozujianfuxuankuangxuanzhong" style=""></span>轮子</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/blocks/rouyi/"><span class="font-icon icon iconfont icon-guihuaheshi" style=""></span>若依rouyi<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="dev"><span class="title"><span class="font-icon icon iconfont icon-kaifa1" style=""></span>dev</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/dev/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"><span class="font-icon icon iconfont icon-xinshouzhinan" style=""></span>项目开发指南<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="项目"><span class="title"><span class="font-icon icon iconfont icon-shixushujuku" style=""></span>项目</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/java-doc/item/learn/"><span class="font-icon icon iconfont icon-xinshouzhinan" style=""></span>学习项目<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="其他"><span class="title"><span class="font-icon icon iconfont icon-qita" style=""></span>其他</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>工具</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other/git/"><span class="font-icon icon iconfont icon-git" style=""></span>Git<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>理论</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other/mode.html"><span class="font-icon icon iconfont icon-shejimoshi" style=""></span>设计模式<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>专业与通用技术</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other/regex.html"><span class="font-icon icon iconfont icon-zhengzebiaodashi" style=""></span>正则<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>插件</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/java-doc/other//plugin/swagger/"><span class="font-icon icon iconfont icon-swagger" style=""></span>swagger<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-xingzhuang" style=""></span><span class="vp-sidebar-title">         MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-redis" style=""></span><span class="vp-sidebar-title">        Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-memcacheyunshujukuMemcac" style=""></span><span class="vp-sidebar-title">    Memcache</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-connection-MongoDB" style=""></span><span class="vp-sidebar-title">    MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-elasticsearch-Elasticsearch" style=""></span><span class="vp-sidebar-title">ElasticSearch</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java-doc/sql/es/map.html"><!---->     -&gt;Map<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">1.ES入门</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">2.HTTP操作</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">3.Java操作ES</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">4.环境部署</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">5.底层原理</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">7.优化</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/java-doc/sql/es/7.%E4%BC%98%E5%8C%96/7-1.%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96.html"><!---->7-1. 基本优化<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/7.%E4%BC%98%E5%8C%96/7-1.%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96.html#硬件"><!---->硬件<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/7.%E4%BC%98%E5%8C%96/7-1.%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96.html#分片策略"><!---->分片策略<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/7.%E4%BC%98%E5%8C%96/7-1.%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96.html#查询优化"><!---->查询优化<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/java-doc/sql/es/7.%E4%BC%98%E5%8C%96/7-1.%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96.html#写入优化"><!---->写入优化<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">x.dev</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->7-1. 基本优化</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://aicell.cc/about" target="_blank" rel="noopener noreferrer">Victor Da V</a></span><span property="author" content="Victor Da V"></span></span><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-06-30T00:00:00.000Z"></span><!----><!----><span class="page-word-info" aria-label="字数🔠" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 2487 字</span><meta property="wordCount" content="2487"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#硬件">硬件</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#分片策略">分片策略</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#查询优化">查询优化</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/java-doc/#写入优化">写入优化</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="硬件" tabindex="-1"><a class="header-anchor" href="#硬件" aria-hidden="true">#</a> 硬件</h2><h4 id="_1-硬盘" tabindex="-1"><a class="header-anchor" href="#_1-硬盘" aria-hidden="true">#</a> 1. 硬盘</h4><p>Elasticsearch 的基础是 Lucene，所有的索引和文档数据是存储在本地的磁盘中。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># 一些与磁盘路由晶哥的配置：./config/elasticserch.yml</span>
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /data <span class="token comment"># data存储的路径</span>
<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> /logs <span class="token comment"># logs文件储存的路径</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因此磁盘性能是ES最大瓶颈（也计划是所有类型服务器的瓶颈）。Elasticsearch 重度使用磁盘，磁盘能处理的吞吐量越大，节点就越稳定。</p><p>一些优化磁盘 I/O 的技巧：</p><ul><li>使用 SSD：IO效率是机械盘的10倍以上</li><li>使用RAID 0：可以提升并发吞吐量 <ul><li>不要使用 其他RAID策略，因为分片副本已经提供了高可用保障。</li></ul></li><li>使用多块硬盘：每个硬盘的IO总速度都是独立的。 <ul><li>允许 Elasticsearch 通过多个 path.data 目录配置把数据条带化分配到它们上面</li></ul></li><li>不要使用远程挂载的存储：会增加额外的网络损耗成本</li></ul><h4 id="_2-内存" tabindex="-1"><a class="header-anchor" href="#_2-内存" aria-hidden="true">#</a> 2. 内存</h4><p>ES 默认安装后设置的内存是 4GB。对于企业级开发，4GB很小，需要重新设置。</p><h5 id="设置es内存" tabindex="-1"><a class="header-anchor" href="#设置es内存" aria-hidden="true">#</a> 设置ES内存</h5><p>ES 目录的 config/jvm.options文件是用来配置内存的。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">################################################################</span>
<span class="token comment">## IMPORTANT: JVM heap size</span>
<span class="token comment">################################################################</span>
<span class="token comment">##</span>
<span class="token comment">## The heap size is automatically configured by Elasticsearch</span>
<span class="token comment">## based on the available memory in your system and the roles</span>
<span class="token comment">## each node is configured to fulfill. If specifying heap is</span>
<span class="token comment">## required, it should be done through a file in jvm.options.d,</span>
<span class="token comment">## which should be named with .options suffix, and the min and</span>
<span class="token comment">## max should be set to the same value. For example, to set the</span>
<span class="token comment">## heap to 4 GB, create a new file in the jvm.options.d</span>
<span class="token comment">## directory containing these lines:</span>
<span class="token comment">##</span>
<span class="token comment">## -Xms4g</span>
<span class="token comment">## -Xmx4g</span>

<span class="token punctuation">-</span>Xms31g  <span class="token comment"># 初始启动大小</span>
<span class="token punctuation">-</span>Xmx31g  <span class="token comment"># 可分配的最大内置值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>确保 Xmx 和 Xms 的大小是相同的，其目的是为了能够在 Java 垃圾回收机制清理完堆区后不需要重新分隔计算堆区的大小而浪费资源，可以减轻伸缩堆大小带来的压力</p><h5 id="内存分片策略" tabindex="-1"><a class="header-anchor" href="#内存分片策略" aria-hidden="true">#</a> 内存分片策略</h5><p>ES 堆内存的分配需要满足以下两个原则：</p><ul><li>不要超过物理内存的 50%：Lucene 的设计目的是把底层 OS 里的数据缓存到内存中。 <ul><li>Lucene 的段是分别存储到单个文件中的，这些文件都是不会变化的，所以很利于缓存，同时操作系统也会把这些段文件缓存起来，以便更快的访问。</li><li>如果我们设置的堆内存过大，Lucene 可用的内存将会减少，就会严重影响降低 Lucene 的全文本查询性能。</li></ul></li><li>堆内存的大小最好不要超过 32GB：在 Java 中，所有对象都分配在堆上，然后有一个 Klass Pointer 指针指向它的类元数据。 <ul><li>这个指针在 64 位的操作系统上为 64 位，64 位的操作系统可以使用更多的内存（2^64）。在 32 位的系统上为 32 位，32 位的操作系统的最大寻址空间为 4GB（2^32）。</li><li>64 位的指针意味着更大的浪费，因为你的指针本身大了。浪费内存不算，更糟糕的是，更大的指针在主内存和缓存器（例如 LLC, L1 等）之间移动数据的时候，会占用更多的带宽。</li></ul></li></ul><p>最终策略：<br> 选用64GB内存的服务器作为ES专用服务器，并为ES分片31G的内存</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">-</span>Xms31g
<span class="token operator">-</span>Xmx31g
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-其他硬件优化" tabindex="-1"><a class="header-anchor" href="#_3-其他硬件优化" aria-hidden="true">#</a> 3. 其他硬件优化</h4><p>最好服务器是专门用来搞ES的，提升硬件利用率。</p><p>对于CPU来说，核心数越多越好。</p><h2 id="分片策略" tabindex="-1"><a class="header-anchor" href="#分片策略" aria-hidden="true">#</a> 分片策略</h2><p>分片设计为ES提供了高可用和高并发的特性，但并不意味着分片和副本越多越好，且分片的数量是不能修改的（会影响的路由计算）。</p><p>在创建索引时，要计算好分片数量（副本数量可以动态更改）。其实倒也不必计划的太长远，大不了后期数据量多了，进行阶段性升级，重建ES服务，进行搜索功能升级和迁移。</p><h4 id="_1-分片的代价" tabindex="-1"><a class="header-anchor" href="#_1-分片的代价" aria-hidden="true">#</a> 1. 分片的代价</h4><p>设计分片时，要了解以下内容：</p><ul><li>分片是有硬件损耗的：一个分片的底层即为一个 Lucene 索引，会消耗一定文件句柄、内存、以及 CPU 运转。</li><li>一个节点分片不要过多：每一个搜索请求都需要命中索引中的每一个分片，如果每一个分片都处于不同的节点还好， 但如果多个分片都需要在同一个节点上竞争使用相同的资源就有些糟糕了。</li><li>相关度统计：用于计算相关度的词项统计信息是基于分片的。如果有许多分片，每一个都只有很少的数据会导致很低的相关度。</li></ul><h4 id="_2-设计分片的基本原则" tabindex="-1"><a class="header-anchor" href="#_2-设计分片的基本原则" aria-hidden="true">#</a> 2. 设计分片的基本原则</h4><p>一个业务索引具体需要分配多少分片可能需要架构师和技术人员对业务的增长有个预先的判断，横向扩展应当分阶段进行。一般来说，我们遵循一些原则：</p><ul><li>分片容量：控制每个分片占用的硬盘容量不超过 ES 的最大 JVM 的堆空间设置 <ul><li>一般设置不超过 32G</li><li>如果索引的总容量在 500G 左右，那分片大小不得超过 16 个</li></ul></li><li>节点数量：一般一个节点有时候就是一台物理机，如果分片数过多，大大超过了节点数，很可能会导致一个节点上存在多个分片，一旦该节点故障，即使保持了 1 个以上的副本，同样有可能会导致数据丢失，集群无法恢复。 <ul><li>一般都设置分片数不超过节点数的 3 倍</li></ul></li><li>副本数量：主分片，副本和节点最大数之间数量，我们分配的时候可以参考以下关系： <ul><li>节点数&lt;=主分片数*（副本数+1）</li></ul></li></ul><h4 id="_3-推迟分片分配" tabindex="-1"><a class="header-anchor" href="#_3-推迟分片分配" aria-hidden="true">#</a> 3. 推迟分片分配</h4><p>当节点产生故障时，集群等待1分支后，就会重写规划新的分片</p><ul><li>中断节点恢复：重新加入的节点会保持其现有的分片数据，不会触发新的分片分配，减少了ES分片时带来的开销</li><li>中断节点未回复：重写分配分片</li></ul><p>可以通过修改参数 delayed_timeout，延长再均衡的时间，可以全局设置也可以在索引级别进行修改:</p><p>PUT /_all/_settings</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;index.unassigned.node_left.delayed_timeout&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5m&quot;</span>  <span class="token comment">//改为5分钟</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查询优化" tabindex="-1"><a class="header-anchor" href="#查询优化" aria-hidden="true">#</a> 查询优化</h2><h4 id="_1-使用路由" tabindex="-1"><a class="header-anchor" href="#_1-使用路由" aria-hidden="true">#</a> 1. 使用路由</h4><p>可以使用路由快速计算文档所在分片，如果不使用路由，就需要对所有的分片进行查询。</p><h2 id="写入优化" tabindex="-1"><a class="header-anchor" href="#写入优化" aria-hidden="true">#</a> 写入优化</h2><p>ES 的默认配置，是综合了数据可靠性、写入速度、搜索实时性等因素。实际使用时可根据业务场景进行偏向性的优化。</p><h4 id="_1-需要优化的方向" tabindex="-1"><a class="header-anchor" href="#_1-需要优化的方向" aria-hidden="true">#</a> 1. 需要优化的方向</h4><p>针对于搜索性能要求不高，但是对写入要求较高的场景，可以考虑以下几个方面来提升写索引的性能：</p><ul><li>加大 Translog Flush ，目的是降低 Iops、Writeblock。</li><li>增加 Index Refresh 间隔，目的是减少 Segment Merge 的次数。</li><li>整 Bulk 线程池和队列。</li><li>优化节点间的任务分布。</li><li>优化 Lucene 层的索引建立，目的是降低 CPU 及 IO。</li></ul><h4 id="_2-批量数据提交" tabindex="-1"><a class="header-anchor" href="#_2-批量数据提交" aria-hidden="true">#</a> 2. 批量数据提交</h4><p>ES 提供了 Bulk API 支持批量操作，当我们有大量的写任务时，可以使用 Bulk 来进行批量写入。</p><p>通用的策略如下：Bulk 默认设置批量提交的数据量不能超过 100M。数据条数一般是根据文档的大小和服务器性能而定的，但是单次批处理的数据大小应从 5MB～15MB 逐渐增加，当性能没有提升时，把这个数据量作为最大值。</p><h4 id="_3-合理使用合并" tabindex="-1"><a class="header-anchor" href="#_3-合理使用合并" aria-hidden="true">#</a> 3. 合理使用合并</h4><p>Lucene 以段的形式存储数据。当有新的数据写入索引时，Lucene 就会自动创建一个新的段。随着数据量的变化，段的数量会越来越多，消耗的多文件句柄数及 CPU 就越多，查询效率就会下降。</p><p>由于 Lucene 段合并的计算量庞大，会消耗大量的 I/O，所以 ES 默认采用较保守的策略，让后台定期进行段合并</p><h4 id="_4-减少-refresh-的次数" tabindex="-1"><a class="header-anchor" href="#_4-减少-refresh-的次数" aria-hidden="true">#</a> 4. 减少 Refresh 的次数</h4><p>Lucene 在新增数据时，采用了延迟写入的策略，默认情况下索引的 refresh_interval 为1 秒。</p><p>Lucene 将待写入的数据先写到内存中，超过 1 秒（默认）时就会触发一次 Refresh，然后 Refresh 会把内存中的的数据刷新到操作系统的文件缓存系统中。</p><p>如果我们对搜索的实效性要求不高，可以将 Refresh 周期延长，例如 30 秒。这样还可以有效地减少段刷新次数，但这同时意味着需要消耗更多的 Heap 内存。</p><h4 id="_5-加大-flush-设置" tabindex="-1"><a class="header-anchor" href="#_5-加大-flush-设置" aria-hidden="true">#</a> 5. 加大 Flush 设置</h4><p>Flush 的主要目的是把文件缓存系统中的段持久化到硬盘，当 Translog 的数据量达到512MB 或者 30 分钟时，会触发一次 Flush。</p><p>index.translog.flush_threshold_size 参数的默认值是 512MB，我们可以进行修改。增加参数值意味着文件缓存系统中可能需要存储更多的数据，所以我们需要为操作系统的文件缓存系统留下足够的空间。</p><h4 id="_6-减少副本的数量" tabindex="-1"><a class="header-anchor" href="#_6-减少副本的数量" aria-hidden="true">#</a> 6. 减少副本的数量</h4><p>ES 为了保证集群的可用性，提供了 Replicas（副本）支持，然而每个副本也会执行分析、索引及可能的合并过程，所以 Replicas 的数量会严重影响写索引的效率。</p><p>当写索引时，需要把写入的数据都同步到副本节点，副本节点越多，写索引的效率就越慢。</p><p>如果需要大批量进行写入操作， 可以先禁止 Replica 复制 ， 设置index.number_of_replicas: 0 关闭副本。在写入完成后，Replica 修改回正常的状态</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><!----><!----></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Victor Da V</div><div class="vp-copyright">Copyright © Free To Copy</div></footer></div><!--]--><!----><!----><!----><!--]--></div>
    <script type="module" src="/java-doc/assets/app-23bfaf90.js" defer></script>
  </body>
</html>
